<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>SUJ Geo walks</title>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
    <script type="text/javascript">

      var path = [];
      var map = null;
      var line = null;
      var drawn_circles = [];
      var step = 0;
      var count = 0;
      var sim_debug = true;

      var test_circlesRAW = [{"centers": [[139.694595336914, 35.6650543212891]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.69596862793, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.694595336914, 35.6623077392578]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.69596862793, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6623077392578]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6595611572266]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.694595336914, 35.6595611572266]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.69596862793, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.698715209961, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.701461791992, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.700088500977, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.702835083008, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6595611572266]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6609344482422]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6609344482422]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6595611572266]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.702835083008, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.700088500977, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.69596862793, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.693222045898, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.693222045898, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.694595336914, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.694595336914, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.693222045898, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.691848754883, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.691848754883, 35.6513214111328]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.689102172852, 35.6499481201172]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.690475463867, 35.6513214111328]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.691848754883, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.694595336914, 35.6513214111328]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.693222045898, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.693222045898, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.69596862793, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.697341918945, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.698715209961, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.698715209961, 35.6513214111328]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.698715209961, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.700088500977, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.702835083008, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.702835083008, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6554412841797]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.709701538086, 35.6526947021484]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.711074829102, 35.6540679931641]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.711074829102, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.713821411133, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.716567993164, 35.6568145751953]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.716567993164, 35.6595611572266]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.715194702148, 35.6609344482422]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.712448120117, 35.6623077392578]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.709701538086, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6664276123047]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6650543212891]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.702835083008, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6623077392578]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.704208374023, 35.6650543212891]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6664276123047]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.705581665039, 35.6691741943359]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.706954956055, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.709701538086, 35.6664276123047]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.712448120117, 35.6650543212891]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.712448120117, 35.6664276123047]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.713821411133, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.716567993164, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.719314575195, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.720687866211, 35.6691741943359]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.719314575195, 35.6678009033203]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.71794128418, 35.6664276123047]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.719314575195, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.722061157227, 35.6650543212891]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.723434448242, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.720687866211, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.723434448242, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}];

        var fakeResponse = {"distance":0.2251955222392658,"body":[[139.6942533,35.6653164],[139.6942411,35.6650102],[139.694243,35.6649389],[139.6942551,35.6648566],[139.694266,35.6647945],[139.6942914,35.6647264],[139.6943336,35.6646567],[139.6944547,35.6645497],[139.6945337,35.6645038],[139.6946716,35.6644511],[139.694809,35.6644078],[139.6949395,35.6643842],[139.6942533,35.6653164],[139.6942411,35.6650102],[139.694243,35.6649389],[139.6942551,35.6648566],[139.694266,35.6647945],[139.6942914,35.6647264],[139.6943336,35.6646567],[139.6944547,35.6645497],[139.6945337,35.6645038],[139.6946716,35.6644511],[139.694809,35.6644078],[139.6949395,35.6643842],[139.695262,35.6633286],[139.69583,35.6628795],[139.6958529,35.6628159],[139.6959585,35.6626274],[139.695957,35.662613],[139.6957737,35.6625024],[139.6954466,35.6627585],[139.6951402,35.6630141],[139.6949969,35.6631424],[139.6948262,35.6629997],[139.6946421,35.6628304],[139.6950967,35.6624813],[139.6948587,35.662351],[139.6943791,35.6620749],[139.6946421,35.6628304],[139.6944418,35.6626633],[139.6940466,35.6623274],[139.6934678,35.6615601],[139.6926776,35.6624858],[139.6940012,35.6630281],[139.6944418,35.6626633],[139.6948587,35.662351],[139.6958043,35.6621359],[139.6957882,35.6622255],[139.6950793,35.6628545],[139.6948262,35.6629997],[139.6959362,35.6631762],[139.6962497,35.6633838],[139.6960752,35.6635015],[139.6961638,35.6635692],[139.6960647,35.6636615],[139.6959893,35.6636921],[139.6958742,35.6638367],[139.6967996,35.6643914],[139.6969694,35.6641],[139.6971155,35.6637474],[139.6973307,35.6628621],[139.6973578,35.6627578],[139.6973779,35.6626918],[139.6974875,35.6625688],[139.6976455,35.6624243],[139.6977391,35.6623838],[139.6978255,35.6623557],[139.6978502,35.662342],[139.6979516,35.6610264],[139.6977527,35.6607185],[139.6974764,35.6603263],[139.6969365,35.6597517],[139.6966583,35.6597694],[139.6964174,35.6599378],[139.6949626,35.6598453],[139.6947543,35.6600937],[139.6938522,35.65954],[139.6943516,35.6582532],[139.6949054,35.6582923],[139.6961629,35.6575052],[139.6965571,35.6571102],[139.6966936,35.6569748],[139.6969623,35.6566973],[139.6973005,35.6563305],[139.697396,35.6561088],[139.6976607,35.6556737],[139.6976607,35.6556737],[139.6987674,35.6560198],[139.6993732,35.6569702],[139.6992023,35.6573223],[139.6990552,35.6575912],[139.6988536,35.6579491],[139.6988137,35.6580287],[139.6986279,35.6583822],[139.698181,35.6591618],[139.6984161,35.6587569],[139.6984653,35.6586787],[139.6985961,35.6584391],[139.6986279,35.6583822],[139.6986279,35.6583822],[139.6989857,35.6581266],[139.6993642,35.657904],[139.6995802,35.6577803],[139.6999077,35.6575776],[139.7002773,35.6573673],[139.7012121,35.6576485],[139.7006035,35.6574375],[139.7006989,35.6570786],[139.7008409,35.6574462],[139.7009337,35.6572678],[139.7019674,35.6568728],[139.7020369,35.6569513],[139.702134,35.6570638],[139.7010826,35.6570187],[139.7007827,35.6564198],[139.7006792,35.6561668],[139.7005816,35.6558629],[139.7004751,35.6549235],[139.7004527,35.6549105],[139.7004391,35.6548912],[139.7004362,35.6548735],[139.7004394,35.6548581],[139.7004507,35.6548419],[139.7004713,35.6548283],[139.7004953,35.6548226],[139.7005218,35.6548252],[139.7005497,35.6548402],[139.7005658,35.6548684],[139.7005619,35.6548936],[139.7005411,35.6549168],[139.7005045,35.6549262],[139.7004751,35.6549235],[139.7004391,35.6548912],[139.7004008,35.6548966],[139.701319,35.655583],[139.7013665,35.6557717],[139.7013993,35.6559152],[139.7014575,35.6561892],[139.7016961,35.6567531],[139.7010826,35.6570187],[139.70096,35.6572434],[139.7024945,35.6572975],[139.7028178,35.6575754],[139.7028934,35.6576435],[139.7030019,35.6577367],[139.7030848,35.6581739],[139.7033807,35.6582342],[139.7038441,35.658276],[139.7041585,35.6583181],[139.7042802,35.6583754],[139.7044328,35.6585301],[139.70463,35.6587336],[139.70521,35.6593873],[139.7052909,35.6594785],[139.7059984,35.6602073],[139.7067639,35.6607299],[139.7077123,35.6613459],[139.7081342,35.6616159],[139.7055011,35.6621931],[139.7054503,35.6621953],[139.7054047,35.6621779],[139.7053403,35.6621779],[139.7037321,35.6610178],[139.703874,35.6605849],[139.7050035,35.6595141],[139.7049576,35.6596533],[139.7048491,35.6599571],[139.7047474,35.6581205],[139.7047631,35.6583467],[139.7042032,35.6570695],[139.7047488,35.6575169],[139.7030019,35.6577367],[139.7030729,35.6577924],[139.702835,35.6579126],[139.7021957,35.6586079],[139.7023336,35.6583515],[139.7023284,35.6583353],[139.7023188,35.6583346],[139.7023102,35.6583416],[139.7021887,35.6585628],[139.7021862,35.6585847],[139.7021957,35.6586079],[139.7004479,35.6580995],[139.6997565,35.6578373],[139.6995802,35.6577803],[139.6990552,35.6575912],[139.6982478,35.6571095],[139.6984579,35.6566765],[139.6985695,35.6572121],[139.6982478,35.6571095],[139.6980588,35.657049],[139.6975132,35.6568751],[139.6969623,35.6566973],[139.6972308,35.6560235],[139.6973366,35.6560567],[139.6974255,35.6560782],[139.6955807,35.6559692],[139.6960264,35.6565628],[139.6965571,35.6571102],[139.6970399,35.6573471],[139.6972027,35.6574397],[139.6973691,35.6575261],[139.6977686,35.6576345],[139.6983043,35.657794],[139.6988536,35.6579491],[139.6972393,35.6578526],[139.6969454,35.6577432],[139.69679,35.6576919],[139.6966395,35.6576572],[139.6965546,35.6576376],[139.6964563,35.6576231],[139.6963671,35.6576207],[139.6962776,35.6576284],[139.6973691,35.6575261],[139.6973913,35.657596],[139.6970528,35.6563654],[139.6971634,35.6563947],[139.6972476,35.6564201],[139.6958483,35.6554665],[139.6956481,35.6552195],[139.6954255,35.6549584],[139.6953996,35.6549244],[139.6952359,35.654724],[139.6951379,35.6545089],[139.6950205,35.6543602],[139.6939483,35.6554491],[139.6942742,35.655861],[139.6928059,35.657009],[139.6928198,35.6568293],[139.6928279,35.6566768],[139.6928547,35.6561554],[139.6928566,35.6560709],[139.6927714,35.6557345],[139.6927971,35.6558262],[139.6928298,35.6559397],[139.6928566,35.6560709],[139.6942551,35.6552361],[139.6939483,35.6554491],[139.6935137,35.6557941],[139.692913,35.6546181],[139.6930318,35.6545516],[139.693185,35.6544969],[139.6932674,35.6544775],[139.6933485,35.6544657],[139.6934383,35.6544588],[139.6935228,35.654468],[139.6937225,35.6545407],[139.6939391,35.653367],[139.6931793,35.6527778],[139.6916306,35.6535341],[139.6918695,35.6536096],[139.6923167,35.6537318],[139.6926015,35.6538212],[139.6928206,35.6539169],[139.6929986,35.6540004],[139.693216,35.6541291],[139.6933556,35.6542368],[139.6935392,35.6543996],[139.6937225,35.6545407],[139.6938611,35.6546852],[139.6942551,35.6552361],[139.6943786,35.655403],[139.6944947,35.655534],[139.6946781,35.6556692],[139.6948726,35.655768],[139.6950305,35.6558271],[139.6951889,35.6558911],[139.6953023,35.6559202],[139.6955807,35.6559692],[139.6968154,35.656218],[139.6971933,35.6550702],[139.697235,35.6549514],[139.697279,35.6548053],[139.6972954,35.6546942],[139.6973082,35.6545648],[139.6973132,35.6544683],[139.6960472,35.6556764],[139.6956364,35.6555851],[139.6952096,35.6554869],[139.6950781,35.6554469],[139.6949231,35.6553925],[139.6948092,35.6553272],[139.6947094,35.6552528],[139.6945006,35.6550204],[139.6942677,35.6547291],[139.6940991,35.6545215],[139.6939133,35.654327],[139.693602,35.6540127],[139.6933893,35.6538844],[139.6928467,35.6536222],[139.6926269,35.6531428],[139.692521,35.6528481],[139.6925113,35.6523643],[139.6924151,35.6521503],[139.6923237,35.6520721],[139.6917892,35.6516133],[139.6927749,35.6501335],[139.6923887,35.6501475],[139.692054,35.6501544],[139.6916935,35.6501475],[139.6908601,35.649844],[139.691069,35.6498696],[139.6890827,35.6501049],[139.6890783,35.6500004],[139.6906895,35.649803],[139.6890766,35.6499612],[139.6889849,35.6499633],[139.6883061,35.6500218],[139.6883032,35.6499801],[139.6883032,35.6499173],[139.6890783,35.6500004],[139.6890766,35.6499612],[139.6890734,35.6498827],[139.6902081,35.6504799],[139.6900636,35.6503782],[139.6912203,35.6518486],[139.6912661,35.6520535],[139.6911397,35.6521513],[139.6910715,35.6523697],[139.6910715,35.6525588],[139.6912761,35.65288],[139.691369,35.6531855],[139.6933509,35.6526819],[139.6931793,35.6527778],[139.6926269,35.6531428],[139.6924175,35.6532813],[139.6922673,35.6533859],[139.6921839,35.6534329],[139.6930448,35.6517565],[139.6942171,35.6518125],[139.6939635,35.6521132],[139.6937187,35.6524034],[139.6933509,35.6526819],[139.6926929,35.6547424],[139.692913,35.6546181],[139.6941836,35.6552462],[139.6946802,35.6550479],[139.6971174,35.6544065],[139.6972161,35.6542668],[139.6973036,35.6541081],[139.6974495,35.6538622],[139.6975901,35.6536523],[139.6977491,35.653397],[139.6979029,35.6531481],[139.6980469,35.6528883],[139.6981732,35.6526747],[139.69835,35.6523755],[139.6985358,35.6520766],[139.6985752,35.6519886],[139.6987513,35.6517139],[139.6989292,35.6514171],[139.6989819,35.6513201],[139.6991527,35.6510441],[139.6993586,35.6506929],[139.6995041,35.6504678],[139.6997448,35.6527187],[139.6993224,35.6525197],[139.6990845,35.6528108],[139.6990002,35.6529104],[139.7000478,35.6516242],[139.6999199,35.6521763],[139.6998586,35.6524309],[139.6998586,35.6525483],[139.6998419,35.6525766],[139.6997448,35.6527187],[139.6996817,35.6528111],[139.6995319,35.6529343],[139.6994638,35.6529867],[139.6993185,35.6531102],[139.699193,35.6532516],[139.6990802,35.6533778],[139.6989354,35.6534551],[139.6988178,35.6535217],[139.6975901,35.6536523],[139.6969973,35.6533686],[139.6971285,35.6531155],[139.6966881,35.6529209],[139.6962908,35.6528962],[139.6985824,35.6541521],[139.6987801,35.6542249],[139.6980469,35.6528883],[139.6977426,35.6525005],[139.697424,35.6520973],[139.6974022,35.6520697],[139.6971412,35.6517616],[139.6970405,35.6517071],[139.6985358,35.6520766],[139.6985995,35.652132],[139.6987372,35.6520605],[139.6990128,35.6537126],[139.6991701,35.6538111],[139.699326,35.6539054],[139.699458,35.6539683],[139.6996059,35.6540317],[139.6998189,35.6541176],[139.6998776,35.6541394],[139.6999375,35.654153],[139.7001405,35.6541845],[139.7003982,35.6542288],[139.7005176,35.6542474],[139.7005905,35.6542596],[139.7006639,35.6542647],[139.7009857,35.6542285],[139.7012897,35.6541901],[139.7015344,35.6541623],[139.7017956,35.6541504],[139.7019776,35.6541441],[139.70218,35.6541509],[139.7023341,35.6541604],[139.7024219,35.6541725],[139.7025714,35.6542002],[139.7026312,35.6542109],[139.7026975,35.6542132],[139.7028116,35.6542149],[139.703083,35.6542097],[139.7033097,35.6542094],[139.7034564,35.6542006],[139.7035272,35.6542063],[139.7036561,35.6542219],[139.7037637,35.6542373],[139.703877,35.6542506],[139.7038997,35.6542572],[139.7039306,35.6542745],[139.703977,35.6542945],[139.704168,35.6544034],[139.7042518,35.6544438],[139.7043557,35.6544827],[139.706399,35.6548703],[139.7061248,35.6544774],[139.7063545,35.6549238],[139.7062363,35.6548213],[139.7060668,35.6545575],[139.7060087,35.654494],[139.7055487,35.6538485],[139.7036189,35.6537346],[139.7035968,35.6539239],[139.7033803,35.6544036],[139.702929,35.6544981],[139.702125,35.6546612],[139.7017119,35.6547374],[139.7023485,35.6539221],[139.7023341,35.6541604],[139.704337,35.6533219],[139.7042307,35.6534614],[139.7042099,35.6527111],[139.704379,35.6526183],[139.7049148,35.6512275],[139.7049481,35.6512883],[139.7049959,35.6513558],[139.7037634,35.6523051],[139.7040953,35.6521156],[139.7043686,35.651975],[139.7056511,35.6515204],[139.7057474,35.6516301],[139.7056924,35.6516636],[139.7056731,35.6516301],[139.706724,35.6524488],[139.7071215,35.6529955],[139.7072032,35.6531808],[139.7072386,35.6532703],[139.7075606,35.6535095],[139.707828,35.6540845],[139.7064502,35.6550339],[139.7065673,35.6552075],[139.7074405,35.6554351],[139.707549,35.6555977],[139.7075773,35.6556683],[139.7061248,35.6544774],[139.7060762,35.6544069],[139.705684,35.653838],[139.7036871,35.6540091],[139.7036561,35.6542219],[139.7052525,35.6534211],[139.7052153,35.6533553],[139.7047724,35.6527727],[139.7047648,35.6527049],[139.7047956,35.6526656],[139.7054898,35.6533925],[139.7054637,35.6533615],[139.7068322,35.6538072],[139.7067133,35.653804],[139.7066654,35.6537591],[139.7063489,35.6535433],[139.7061584,35.6534125],[139.7061558,35.6533536],[139.706365,35.6531205],[139.7065823,35.6529156],[139.7066547,35.6528677],[139.7067324,35.6528546],[139.7068156,35.6529265],[139.7069352,35.6531319],[139.7069739,35.6532622],[139.7070248,35.6535695],[139.7068322,35.6538072],[139.7067621,35.6538955],[139.7066088,35.6540488],[139.706383,35.6542456],[139.7061751,35.6543546],[139.7060762,35.6544069],[139.7051697,35.6530583],[139.7056239,35.6527381],[139.7069953,35.6520475],[139.7071215,35.6519254],[139.7089269,35.6529111],[139.7090685,35.6529448],[139.7091852,35.6529584],[139.7093199,35.6529602],[139.7093771,35.6529494],[139.7094052,35.6529485],[139.7094556,35.6529485],[139.7095454,35.6529594],[139.7096621,35.6530068],[139.7098011,35.6530916],[139.7098887,35.6531445],[139.7099505,35.6531819],[139.7101322,35.6532867],[139.7102399,35.6533405],[139.7103875,35.6534175],[139.710485,35.6534732],[139.7105384,35.6535055],[139.7106827,35.6537048],[139.7107296,35.6537674],[139.7107609,35.6538153],[139.7109846,35.6539756],[139.7111073,35.6540694],[139.7111494,35.6541241],[139.7113237,35.6543367],[139.7113996,35.6544774],[139.711471,35.6545771],[139.7097367,35.6551306],[139.7100815,35.6553381],[139.7109575,35.6558272],[139.7115235,35.6561408],[139.7127908,35.6566945],[139.7132892,35.656884],[139.7140343,35.6570881],[139.7145293,35.6572829],[139.7172304,35.6571982],[139.7174101,35.6571263],[139.7175447,35.6570826],[139.7177348,35.6570211],[139.7181573,35.6568843],[139.7160826,35.6564855],[139.716135,35.6566663],[139.7166954,35.6592553],[139.7167281,35.6593861],[139.7169912,35.6601738],[139.7188224,35.6594916],[139.7186112,35.6595724],[139.7182036,35.6597233],[139.7178729,35.6598457],[139.7175412,35.6599709],[139.7170887,35.6601367],[139.7169912,35.6601738],[139.7164402,35.6603738],[139.7164102,35.6603828],[139.7156927,35.6606504],[139.7148363,35.6609945],[139.7145515,35.6611181],[139.7141813,35.661293],[139.7140254,35.6613689],[139.7137764,35.6614902],[139.7128499,35.6619697],[139.7124135,35.662199],[139.7118064,35.662518],[139.7107382,35.6630942],[139.7106078,35.6632222],[139.707878,35.6643604],[139.7075568,35.6641537],[139.7074802,35.664082],[139.7072752,35.6638266],[139.7072566,35.6638051],[139.7072003,35.6638418],[139.7076134,35.6645692],[139.707878,35.6643604],[139.7079818,35.6643072],[139.708025,35.6642869],[139.7081504,35.6642671],[139.7082026,35.6642766],[139.708381,35.6644338],[139.7090851,35.663914],[139.7087963,35.6636308],[139.7066974,35.6642928],[139.7068979,35.6639418],[139.7070002,35.6640247],[139.7076134,35.6645692],[139.707875,35.6647875],[139.7062025,35.665522],[139.706545,35.6651608],[139.7072011,35.6665608],[139.7067098,35.666146],[139.7045343,35.6653778],[139.7045104,35.6653532],[139.7044813,35.6653294],[139.704366,35.6652695],[139.704262,35.6652081],[139.7046687,35.663809],[139.7055168,35.6631833],[139.7029558,35.6632419],[139.7028113,35.6630132],[139.7049812,35.6626667],[139.7048521,35.6625701],[139.7047958,35.6624982],[139.7047447,35.6624154],[139.7046939,35.6622825],[139.7049147,35.66482],[139.7051769,35.6643503],[139.7055081,35.6645412],[139.7052339,35.664896],[139.7055477,35.6667818],[139.7054513,35.6667888],[139.705356,35.6667855],[139.7052459,35.6666733],[139.7052098,35.666628],[139.70515,35.6665901],[139.7050068,35.6665038],[139.704948,35.6663243],[139.7046367,35.6660935],[139.7044794,35.6659743],[139.7044439,35.6659482],[139.7045108,35.66585],[139.7040906,35.6654719],[139.7038847,35.6652984],[139.7062608,35.6655568],[139.706168,35.6656557],[139.7060525,35.6657402],[139.7058764,35.6659293],[139.7055259,35.6677497],[139.7058875,35.66758],[139.7041291,35.6666908],[139.7038937,35.6668122],[139.703458,35.6670761],[139.7034062,35.6670925],[139.7045222,35.6672366],[139.7046686,35.6671273],[139.7047922,35.6670258],[139.7052459,35.6666733],[139.7071429,35.667806],[139.7070079,35.6676184],[139.7075338,35.6692312],[139.7076949,35.6691379],[139.7079533,35.66943],[139.7061936,35.6696051],[139.7060076,35.6697354],[139.7059532,35.6698003],[139.7057638,35.6701068],[139.7057556,35.670117],[139.7057326,35.6701457],[139.7054748,35.6703464],[139.7053693,35.6704126],[139.7053106,35.670458],[139.7037855,35.6692835],[139.7039911,35.6691919],[139.7044723,35.6689743],[139.7052161,35.6686237],[139.705386,35.6685437],[139.7055942,35.6684531],[139.7061238,35.6682168],[139.7064993,35.6680368],[139.7068605,35.6678675],[139.7072083,35.6677035],[139.708126,35.6672841],[139.7086213,35.6670578],[139.7100869,35.666373],[139.7106274,35.6661206],[139.7107286,35.6660734],[139.711592,35.6656701],[139.7123431,35.6653284],[139.7125087,35.665253],[139.7126235,35.6651409],[139.7123065,35.6660071],[139.7122009,35.6660784],[139.7120501,35.666175],[139.7118961,35.666272],[139.7126616,35.666709],[139.7130029,35.6670058],[139.7130218,35.6670545],[139.7133216,35.6671993],[139.7134654,35.6672752],[139.7136053,35.6673689],[139.7136441,35.6674044],[139.7137227,35.6674761],[139.7137935,35.6675691],[139.7139851,35.6677976],[139.7170706,35.6678843],[139.7172142,35.6677246],[139.7172818,35.6676686],[139.7173506,35.6676306],[139.7174802,35.6675704],[139.7175873,35.6675378],[139.7176258,35.6675276],[139.7177331,35.6675025],[139.7178166,35.6674965],[139.7179839,35.6674873],[139.7184639,35.6674207],[139.7187153,35.6673713],[139.7188518,35.6673331],[139.718961,35.6672874],[139.719038,35.6672393],[139.7192112,35.6671411],[139.7194928,35.6669424],[139.7196401,35.6668079],[139.7199111,35.6665191],[139.7199694,35.6664467],[139.7194796,35.6674282],[139.7195654,35.667463],[139.7196341,35.6675049],[139.7208999,35.6662562],[139.7207565,35.6666067],[139.7204704,35.6672759],[139.7202541,35.6677819],[139.7200904,35.6681648],[139.719925,35.6685517],[139.7205607,35.6692006],[139.7197433,35.6689578],[139.7216435,35.6694681],[139.721372,35.669376],[139.7213269,35.6693614],[139.7205939,35.6691452],[139.7212115,35.6695967],[139.7213269,35.6693614],[139.7197433,35.6689578],[139.7199163,35.6685492],[139.7193868,35.6684067],[139.7195456,35.6680099],[139.7197007,35.6676221],[139.7176658,35.6664041],[139.7178531,35.6666324],[139.7179658,35.6666403],[139.7179998,35.666666],[139.7187711,35.6639424],[139.7189588,35.664027],[139.719167,35.6641019],[139.7197196,35.6642403],[139.7204779,35.66444],[139.7223531,35.6649276],[139.7236254,35.6632306],[139.7230894,35.6630944],[139.7220084,35.6628227],[139.7213132,35.6626441],[139.7236192,35.6628887],[139.7232096,35.6627956],[139.720486,35.6643342],[139.7202325,35.6642825],[139.7201105,35.6639702],[139.720098,35.6636079],[139.7201727,35.663092],[139.7214368,35.6622701],[139.7211407,35.6619719],[139.721036,35.6618391],[139.7209538,35.6617221],[139.7229687,35.6633953],[139.723813,35.6636173],[139.7236013,35.6641895],[139.7218353,35.664731],[139.7219542,35.664426],[139.7220658,35.664149],[139.7221789,35.6638477]]};

        var test_fences = [{"name":"Density 0.1","foreign_id":"density_0_1","area":2.77417209375,"priority":1.0,"access_level":1000,"meta":null,"tags":[],"created_at":"2013-08-08T07:17:42Z","updated_at":"2013-08-09T07:07:04Z","id":"520346160bc24d6fc6000001","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001","shapes":[{"id":"5204634c0bc24dbadc00000a","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.676785,35.666501],[139.679189,35.665943],[139.679189,35.663503],[139.6773,35.663224],[139.676356,35.665176],[139.677644,35.665316]],"area":0.09640811328125,"centroid":[139.678004725646,35.6647591038487],"nw_corner":[139.676356,35.666501],"se_corner":[139.679189,35.663224],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:34:36Z","updated_at":"2013-08-09T03:34:36Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/5204634c0bc24dbadc00000a"},{"id":"520463560bc24dbadc00000c","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.707255,35.662038],[139.709229,35.662457],[139.709573,35.661759],[139.709229,35.660295],[139.7088,35.659388],[139.7082,35.658133],[139.706998,35.657505],[139.70777,35.65904],[139.705967,35.660156],[139.708114,35.661341]],"area":0.1187916640625,"centroid":[139.708097671911,35.6603378612596],"nw_corner":[139.705967,35.662457],"se_corner":[139.709573,35.657505],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:34:46Z","updated_at":"2013-08-09T07:07:01Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463560bc24dbadc00000c"},{"id":"5204637f0bc24dbadc00000f","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.673953,35.65632],[139.672322,35.655622],[139.672494,35.654297],[139.674039,35.653391],[139.675326,35.654995],[139.675841,35.65639]],"area":0.100914015625,"centroid":[139.673983779503,35.6551092751973],"nw_corner":[139.672322,35.65639],"se_corner":[139.675841,35.653391],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:27Z","updated_at":"2013-08-09T03:35:27Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/5204637f0bc24dbadc00000f"},{"id":"5204636e0bc24dbadc00000e","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.700818,35.667199],[139.703479,35.66671],[139.705796,35.665316],[139.703822,35.662666],[139.703565,35.664619],[139.701934,35.665664],[139.698672,35.664619],[139.697986,35.666292]],"area":0.210904390625,"centroid":[139.702019516023,35.6656228587373],"nw_corner":[139.697986,35.667199],"se_corner":[139.705796,35.662666],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:10Z","updated_at":"2013-08-09T03:35:10Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/5204636e0bc24dbadc00000e"},{"id":"520463830bc24dbadc000010","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.728799,35.660504],[139.725881,35.663015],[139.721589,35.660644],[139.719872,35.657227],[139.72425,35.655692]],"area":0.53855724609375,"centroid":[139.72427408362,35.6592861892347],"nw_corner":[139.719872,35.663015],"se_corner":[139.728799,35.655692],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:31Z","updated_at":"2013-08-09T03:35:31Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463830bc24dbadc000010"},{"id":"520463680bc24dbadc00000d","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.691463,35.654158],[139.693995,35.653739],[139.69378,35.655692],[139.69481,35.657505],[139.69275,35.658342],[139.692922,35.656669]],"area":0.10903845703125,"centroid":[139.693219679113,35.6558359444916],"nw_corner":[139.691463,35.658342],"se_corner":[139.69481,35.653739],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:04Z","updated_at":"2013-08-09T07:06:50Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463680bc24dbadc00000d"},{"id":"520463500bc24dbadc00000b","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.693093,35.665037],[139.692063,35.663782],[139.689231,35.663084],[139.686484,35.663642],[139.688973,35.665386]],"area":0.1403940625,"centroid":[139.689852183049,35.6642640628291],"nw_corner":[139.686484,35.665386],"se_corner":[139.693093,35.663084],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:34:40Z","updated_at":"2013-08-09T03:34:40Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463500bc24dbadc00000b"},{"id":"520460ea0bc24dbadc000006","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.658418,35.673056],[139.662023,35.671801],[139.661336,35.669883],[139.658761,35.670197],[139.657731,35.669569]],"area":0.1387431953125,"centroid":[139.659761189308,35.6712557559906],"nw_corner":[139.657731,35.673056],"se_corner":[139.662023,35.669569],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:24:26Z","updated_at":"2013-08-09T03:24:34Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520460ea0bc24dbadc000006"},{"id":"520460e40bc24dbadc000005","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.73721,35.650601],[139.737124,35.652275],[139.734292,35.652624],[139.732318,35.651926],[139.733176,35.65088]],"area":0.1122506015625,"centroid":[139.735017402301,35.6515967604458],"nw_corner":[139.732318,35.652624],"se_corner":[139.73721,35.650601],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:24:20Z","updated_at":"2013-08-09T03:24:20Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520460e40bc24dbadc000005"},{"id":"520463aa0bc24dbadc000013","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.702449,35.65904],[139.699531,35.65897],[139.697986,35.657715],[139.699531,35.657157],[139.702621,35.656982]],"area":0.10996762890625,"centroid":[139.700667265409,35.6580124851671],"nw_corner":[139.697986,35.65904],"se_corner":[139.702621,35.656982],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:36:10Z","updated_at":"2013-08-09T03:36:18Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463aa0bc24dbadc000013"},{"id":"5204639c0bc24dbadc000012","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.714379,35.667268],[139.717641,35.666501],[139.718585,35.663921],[139.714637,35.665455]],"area":0.11023234375,"centroid":[139.716400508244,35.665733701646],"nw_corner":[139.714379,35.667268],"se_corner":[139.718585,35.663921],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:56Z","updated_at":"2013-08-09T03:35:56Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/5204639c0bc24dbadc000012"},{"id":"520463940bc24dbadc000011","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.685369,35.65897],[139.682536,35.657017],[139.686227,35.656111],[139.687085,35.658063]],"area":0.10602077734375,"centroid":[139.685163462463,35.6574701052571],"nw_corner":[139.682536,35.65897],"se_corner":[139.687085,35.656111],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T03:35:48Z","updated_at":"2013-08-09T03:35:48Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520463940bc24dbadc000011"},{"id":"520494eb0bc24d2015000001","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.669554,35.664618],[139.668438,35.661829],[139.663632,35.662248],[139.665091,35.666989],[139.668009,35.666989]],"area":0.34630221484375,"centroid":[139.666655453937,35.6643337247999],"nw_corner":[139.663632,35.666989],"se_corner":[139.669554,35.661829],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T07:06:19Z","updated_at":"2013-08-09T07:06:19Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520494eb0bc24d2015000001"},{"id":"520495000bc24d2015000003","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.737275,35.6695],[139.738047,35.666013],[139.735472,35.6642],[139.731696,35.665874],[139.734614,35.66678]],"area":0.2126560546875,"centroid":[139.735658944283,35.6663714886163],"nw_corner":[139.731696,35.6695],"se_corner":[139.738047,35.6642],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T07:06:40Z","updated_at":"2013-08-09T07:06:40Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520495000bc24d2015000003"},{"id":"520494f10bc24d2015000002","type":"polygon","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.660714,35.656599],[139.667752,35.656529],[139.668353,35.653879],[139.665863,35.652345],[139.6614,35.652066],[139.665949,35.654297],[139.661486,35.654925]],"area":0.322991328125,"centroid":[139.664960213213,35.6547363275718],"nw_corner":[139.660714,35.656599],"se_corner":[139.668353,35.652066],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-08-09T07:06:25Z","updated_at":"2013-08-09T07:06:25Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/520346160bc24d6fc6000001/shapes/520494f10bc24d2015000002"}]}];

      function getNewPath() {
        // Make ajax call
        var xhReq = new XMLHttpRequest();
        xhReq.open("GET", "/?lon="+$('.lon').val()+"&lat="+$('.lat').val()+"&length="+$('.length').val(), false);
        xhReq.send(null);
        var serverResponse = xhReq.responseText;
        if (sim_debug) {
          var objJSON = fakeResponse;
        }
        else {
          var objJSON = JSON.parse(serverResponse);
        }

        // Update data
        path = [];
        objJSON['body'].forEach( function(p) {
          if (p) {
            path.push(new google.maps.LatLng(p[1],p[0]));
          }
          else{
            console.log(objJSON['body'])
          }
        });

        // Dumb refresh
        initialize();
        if (sim_debug) {
          update_circles();
          draw_fences();
        }
      }

      function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        map = new google.maps.Map(mapDiv, {
          center: new google.maps.LatLng($('.lat').val(),$('.lon').val()),
          zoom: 15,
          scaleControl: true,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
        };

        line = new google.maps.Polyline({
          path: path,
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          strokeColor: '#ff0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
      
        google.maps.LatLng.prototype.kmTo = function(a){ 
          var e = Math, ra = e.PI/180; 
          var b = this.lat() * ra, c = a.lat() * ra, d = b - c; 
          var g = this.lng() * ra - a.lng() * ra; 
          var f = 2 * e.asin(e.sqrt(e.pow(e.sin(d/2), 2) + e.cos(b) * e.cos(c) * e.pow(e.sin(g/2), 2))); 
          return f * 6378.137; 
        } 
        
        var inKm = function(n){ 
          var a = n, len = a.length, dist = 0; 
          for(var i=0; i<len-1; i++){ 
            dist += a[i].kmTo(a[i+1]); 
          } 
          return dist; 
        } 
      
        $('.info').html("Route length: "+inKm(path).toPrecision(4)+" Km");
        line.setMap(map);
      }

      function animateArrow(sense) {
        //var count = 0;
        //offsetId = window.setInterval(function() {
          if (sense == -1) {
            count = (count - 1) % 200;
          }
          else {
            count = (count + 1) % 200;
          }

          var icons = line.get('icons');
          icons[0].offset = (count / 2) + '%';
          line.set('icons', icons);
        //}, 250);
      }

      function draw_fences() {
        test_fences[0]['shapes'].forEach( function(s) {
          if (s['type'] == 'polygon') {
            shapepath = [];
            s['generators'].forEach( function(p) {
              if (p) {
                shapepath.push(new google.maps.LatLng(p[1],p[0]));
              }
              else{
                console.log(objJSON['body'])
              }
            });

            console.log(shapepath);

            // Draw shape
            var shapeOptions = {
              strokeColor: "#0F0F0F",
              strokeOpacity: 0.15,
              strokeWeight: 1,
              fillColor: "#0F0F0F",
              fillOpacity: 0.15,
              map: map,
              path: shapepath
            };
            var shape = new google.maps.Polygon(shapeOptions);

            shape.setMap(map);
          }
          else if (s['type'] == 'circle') {
            point = new google.maps.LatLng(s['generators'][0][1],s['generators'][0][0]);

            // Draw circles
            var populationOptions = {
              strokeColor: "#0F000F",
              strokeOpacity: 0.15,
              strokeWeight: 1,
              fillColor: "#0F000F",
              fillOpacity: 0.15,
              map: map,
              center: point,
              radius: s['radius']*0.81
            };
            new google.maps.Circle(populationOptions);
          }
        });
      }

      function update_circles() {
        // Bounding check for buttons
        if (step < 0 ) {
          step = 0;
          return;
        }
        if (step >= test_circlesRAW.length ) {
          step = test_circlesRAW.length;
          return;
        }

        // Delete previous circles
        drawn_circles.forEach( function(c) {
          c.setMap(null);
        });

        // Draw each of the new circles
        var test_circles = test_circlesRAW[step];
        //for (var i=0; i<test_circles.length; i++) {
        test_circles['centers'].forEach( function(p) {
          if (p) {
            point = new google.maps.LatLng(p[1],p[0]);

            var col = null;
            if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#FF0000";
            }
            else if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#00FF00";
            }
            else {
              col = "#0000FF";
            }

            // Draw circles
            var populationOptions = {
              strokeColor: col,
              strokeOpacity: 0.6,
              strokeWeight: 1,
              fillColor: col,
              fillOpacity: 0.35,
              map: map,
              center: point,
              radius: test_circles['radii'][test_circles['centers'].indexOf(p)]*0.81
            };
            var c = new google.maps.Circle(populationOptions);
            drawn_circles.push(c);

          }
          else{
            console.log(test_circles['centers'])
          }
        //}
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body style="font-family: Arial; border: 0 none;">
    <div id="map-canvas" style="width: 800px; height: 400px"></div>
    <div>
      Position: 
      <button onclick='animateArrow(-1);' type="button">&lt;</button>
      <button onclick='animateArrow(1);' type="button">&gt;</button>
      <br>
      Request:
      <button onclick='if (sim_debug) { step -= 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&lt;</button>
      <button onclick='if (sim_debug) { step += 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&gt;</button>
      <br>
      Lon: <input class="lon" type="text" name="lon" value="139.698345">
      Lat: <input class="lat" type="text" name="lat" value="35.666641">
      Length: <input class="length" type="text" name="length" value="2000">m
      <br>
      <input type="submit" onclick="getNewPath()" value="Get new route">
    </div>
    <div class="info"></div>
  </body>
</html>
