<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>SUJ Geo walks</title>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
    <script type="text/javascript">

      var path = [];
      var map = null;
      var line = null;
      var drawn_circles = [];
      var step = 0;
      var count = 0;
      var sim_debug = true;

      var test_circlesRAW = [{"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6997568, 35.666651]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6997893, 35.6667987333333]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6998543, 35.6670942]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.699774566667, 35.6667228666667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6997347, 35.6665372]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7000152, 35.6665468]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7002847, 35.6665547]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7004871, 35.66651115]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7002882, 35.6663608]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.69997276, 35.66609776]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 57.26362265402]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.69965732, 35.66583472]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 95.4393710900334]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6994996, 35.6657032]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 78.7013215693457]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6995782, 35.6656964]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 76.3514968720267]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6996389, 35.6657043]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 76.3514968720267]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.699948025, 35.66635445]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.700491125, 35.666453225]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.700896975, 35.666638075]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.701208, 35.6668598]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 60.3611582197065]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70166515, 35.66643385]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7017396, 35.6662454]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70181405, 35.66605695]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7018885, 35.6658685]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70196295, 35.66568005]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7020374, 35.6654916]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 57.26362265402]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7022502, 35.6654462]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 60.3611582197065]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7028268, 35.6653454]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 18]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7029913, 35.6652658]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.702975033333, 35.6650779833333]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7029425, 35.66470235]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286]}, {"centers": [[139.700775146484, 35.6602478027344], [139.703521728516, 35.6602478027344], [139.700775146484, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.702909966667, 35.6643267166667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 95.4393710900334]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7030126, 35.6644695]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 57.26362265402]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7034806, 35.66487884]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7036201, 35.66499818]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7037596, 35.66511752]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7038991, 35.66523686]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7043512, 35.66511045]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70426754, 35.66487374]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70409468, 35.66473468]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70392182, 35.66459562]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70374896, 35.66445656]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6602478027344], [139.703521728516, 35.6602478027344], [139.700775146484, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.7035761, 35.6643175]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 57.26362265402]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.70374665, 35.66442525]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7039172, 35.664533]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7042583, 35.6647485]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.700775146484, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7046959, 35.6647961666667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768]}, {"centers": [[139.703521728516, 35.6629943847656], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.706268310547, 35.6657409667969]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 566.190087927757]}];

        var fakeResponse = {"distance":0.01838448581082566,"body":[[139.6997568,35.666651],[139.6998543,35.6670942],[139.6997347,35.6665372],[139.7000152,35.6665468],[139.7002847,35.6665547],[139.7006895,35.6664676],[139.7006266,35.6665104],[139.7005704,35.6665249],[139.7005068,35.6665125],[139.7004148,35.6664693],[139.7002882,35.6663608],[139.6994996,35.6657032],[139.6995782,35.6656964],[139.6996389,35.6657043],[139.6997465,35.6657774],[139.7000152,35.6665468],[139.7002882,35.6663608],[139.7010999,35.6667305],[139.701208,35.6668598],[139.7014516,35.66687],[139.7014418,35.6669992],[139.7020374,35.6654916],[139.7022502,35.6654462],[139.7028268,35.6653454],[139.7029913,35.6652658],[139.7028937,35.6641389],[139.7028797,35.6641606],[139.7028592,35.6642055],[139.7029078,35.6643141],[139.7029614,35.6644054],[139.7030126,35.6644695],[139.7030904,35.6645551],[139.7032603,35.6647376],[139.7033411,35.6647595],[139.7040386,35.6653562],[139.7041494,35.6652797],[139.704262,35.6652081],[139.7044404,35.6650128],[139.7035761,35.6643175],[139.7042583,35.6647485],[139.7049147,35.66482],[139.7051769,35.6643503],[139.7055081,35.6645412],[139.7052339,35.664896],[139.7064573,35.665663],[139.7066718,35.665353],[139.7062025,35.665522],[139.706545,35.6651608],[139.7072701,35.6652068],[139.7069542,35.6649935],[139.7066424,35.664809],[139.7062869,35.6646207],[139.7066436,35.6642663],[139.7072752,35.6638266],[139.7074607,35.6637305],[139.7073689,35.663597],[139.7075614,35.6635176],[139.7079319,35.6640603],[139.7076134,35.6645692],[139.707878,35.6643604],[139.7079818,35.6643072],[139.708025,35.6642869],[139.7081504,35.6642671],[139.7082026,35.6642766],[139.708381,35.6644338]]};

      function getNewPath() {
        // Make ajax call
        var xhReq = new XMLHttpRequest();
        xhReq.open("GET", "/?lon="+$('.lon').val()+"&lat="+$('.lat').val()+"&length="+$('.length').val(), false);
        xhReq.send(null);
        var serverResponse = xhReq.responseText;
        if (sim_debug) {
          var objJSON = fakeResponse;
        }
        else {
          var objJSON = JSON.parse(serverResponse);
        }

        // Update data
        path = [];
        objJSON['body'].forEach( function(p) {
          if (p) {
            path.push(new google.maps.LatLng(p[1],p[0]));
          }
          else{
            console.log(objJSON['body'])
          }
        });

        // Dumb refresh
        initialize();
        if (sim_debug) {
          update_circles();
        }
      }

      function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        map = new google.maps.Map(mapDiv, {
          center: new google.maps.LatLng($('.lat').val(),$('.lon').val()),
          zoom: 15,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
        };

        line = new google.maps.Polyline({
          path: path,
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          strokeColor: '#ff0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
      
        google.maps.LatLng.prototype.kmTo = function(a){ 
          var e = Math, ra = e.PI/180; 
          var b = this.lat() * ra, c = a.lat() * ra, d = b - c; 
          var g = this.lng() * ra - a.lng() * ra; 
          var f = 2 * e.asin(e.sqrt(e.pow(e.sin(d/2), 2) + e.cos(b) * e.cos(c) * e.pow(e.sin(g/2), 2))); 
          return f * 6378.137; 
        } 
        
        var inKm = function(n){ 
          var a = n, len = a.length, dist = 0; 
          for(var i=0; i<len-1; i++){ 
            dist += a[i].kmTo(a[i+1]); 
          } 
          return dist; 
        } 
      
        $('.info').html("Route length: "+inKm(path).toPrecision(4)+" Km");
        line.setMap(map);
      }

      function animateArrow(sense) {
        //var count = 0;
        //offsetId = window.setInterval(function() {
          if (sense == -1) {
            count = (count - 1) % 200;
          }
          else {
            count = (count + 1) % 200;
          }

          var icons = line.get('icons');
          icons[0].offset = (count / 2) + '%';
          line.set('icons', icons);
        //}, 250);
      }


      function update_circles() {
        // Bounding check for buttons
        if (step < 0 ) {
          step = 0;
          return;
        }
        if (step >= test_circlesRAW.length ) {
          step = test_circlesRAW.length;
          return;
        }

        // Delete previous circles
        drawn_circles.forEach( function(c) {
          c.setMap(null);
        });

        // Draw each of the new circles
        var test_circles = test_circlesRAW[step];
        test_circles['centers'].forEach( function(p) {
          if (p) {
            point = new google.maps.LatLng(p[1],p[0]);

            // Draw circles
            var populationOptions = {
              strokeColor: "#FF0000",
              strokeOpacity: 0.6,
              strokeWeight: 1,
              fillColor: "#FF0000",
              fillOpacity: 0.35,
              map: map,
              center: point,
              radius: test_circles['radii'][test_circles['centers'].indexOf(p)]*0.81
            };
            var c = new google.maps.Circle(populationOptions);
            drawn_circles.push(c);

          }
          else{
            console.log(test_circles['centers'])
          }
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body style="font-family: Arial; border: 0 none;">
    <div id="map-canvas" style="width: 800px; height: 400px"></div>
    <div>
      Position: 
      <button onclick='animateArrow(-1);' type="button">&lt;</button>
      <button onclick='animateArrow(1);' type="button">&gt;</button>
      <br>
      Request:
      <button onclick='if (sim_debug) { step -= 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&lt;</button>
      <button onclick='if (sim_debug) { step += 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&gt;</button>
      <br>
      Lon: <input class="lon" type="text" name="lon" value="139.698345">
      Lat: <input class="lat" type="text" name="lat" value="35.666641">
      Length: <input class="length" type="text" name="length" value="2000">m
      <br>
      <input type="submit" onclick="getNewPath()" value="Get new route">
    </div>
    <div class="info"></div>
  </body>
</html>
