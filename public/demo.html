<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>SUJ Geo walks</title>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
    <script type="text/javascript">

      var path = [];
      var map = null;
      var line = null;
      var drawn_circles = [];
      var step = 0;
      var count = 0;
      var sim_debug = true;

      var test_circlesRAW = [{"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6979236, 35.6669531]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 85.3635685948572], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6981863, 35.6663215]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6980392, 35.6664782]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6978921, 35.6666349]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 53.9886611919536], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6975979, 35.6669483]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 107.977322383907], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6657409667969], [139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.698028564453, 35.6684875488281]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 566.190087927757], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6657409667969], [139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.698028564453, 35.6684875488281]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 566.190087927757], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.699592, 35.6666487]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 18], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.69954775, 35.6664566833333]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6995035, 35.6662646666667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 42.6817842974286], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.699415, 35.6658806333333]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 97.3294431106207], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.69937075, 35.6656886166667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 107.977322383907], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6993265, 35.6654966]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 95.4393710900334], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6984418, 35.6651256]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.698154433333, 35.6652611333333]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.697949766667, 35.6652545666667]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.69752825, 35.66524105]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6979002, 35.66502335]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 53.9886611919536], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.698489, 35.6648126]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6988208, 35.6648762]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6990391, 35.6650189]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.695281982422, 35.6629943847656], [139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.695281982422, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.695281982422, 35.6684875488281], [139.700775146484, 35.6684875488281], [139.6993244, 35.6652587]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 76.3514968720267], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.6997896, 35.6656882]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 68.8223092326302], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7002453, 35.66613778]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 60.3611582197065], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7006266, 35.6665104]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7007541, 35.6666025]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7010999, 35.6667305]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 53.9886611919536], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7015844, 35.6667824]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 26.9943305959768], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6629943847656], [139.700775146484, 35.6629943847656], [139.703521728516, 35.6629943847656], [139.698028564453, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.703521728516, 35.6684875488281], [139.7017055, 35.6670675]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 18], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.7017216, 35.6672545]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 19.0878742180067], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.7017377, 35.6674415]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 18], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.701759566667, 35.6676594]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 38.1757484360134], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.7018033, 35.6680952]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 53.9886611919536], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.698028564453, 35.6657409667969], [139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.7018634, 35.66856555]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 188.730029309252, 97.3294431106207], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.702325, 35.6691596]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 152.702993744053], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.700775146484, 35.6657409667969], [139.703521728516, 35.6657409667969], [139.700775146484, 35.6684875488281], [139.7037855, 35.6692835]], "radii": [188.730029309252, 188.730029309252, 188.730029309252, 175.981504948127], "type": ["ARRIVING", "ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.706268310547, 35.6684875488281]], "radii": [188.730029309252, 188.730029309252, 566.190087927757], "type": ["ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.703521728516, 35.6657409667969], [139.703521728516, 35.6684875488281], [139.706268310547, 35.6684875488281]], "radii": [188.730029309252, 188.730029309252, 566.190087927757], "type": ["ARRIVING", "ARRIVING", "LEAVING"]}];

        var fakeResponse = {"distance":0.019089555171858213,"body":[[139.6979236,35.6669531],[139.6979409,35.6668709],[139.6979687,35.6667758],[139.6979981,35.6666938],[139.6980284,35.6666264],[139.6981863,35.6663215],[139.6974508,35.667105],[139.6971175,35.667718],[139.6957726,35.6684739],[139.6958451,35.6684899],[139.6959265,35.6684972],[139.6960274,35.6684966],[139.6962123,35.668465],[139.6962816,35.6684533],[139.6963539,35.6684492],[139.6964324,35.6684525],[139.6964675,35.6684386],[139.6965645,35.6684389],[139.6973763,35.6684766],[139.6974129,35.6684913],[139.6975346,35.6683054],[139.6975248,35.6684524],[139.698664,35.6681459],[139.6986702,35.6675154],[139.6984688,35.6674045],[139.6992594,35.6669198],[139.699592,35.6666487],[139.6993265,35.6654966],[139.699493,35.6653777],[139.6984418,35.6651256],[139.6983591,35.6652677],[139.6977451,35.665248],[139.6973114,35.6652341],[139.698489,35.6648126],[139.6986238,35.6648264],[139.6986834,35.664836],[139.6988208,35.6648762],[139.6988617,35.6648994],[139.698957,35.6649555],[139.6990391,35.6650189],[139.6993244,35.6652587],[139.6994063,35.6652989],[139.699493,35.6653777],[139.6997447,35.6656063],[139.6997896,35.6656882],[139.7005491,35.6664375],[139.7006266,35.6665104],[139.7006577,35.6665396],[139.700713,35.6665767],[139.7007541,35.6666025],[139.7008105,35.6666345],[139.700872,35.6666663],[139.700921,35.6666855],[139.7009745,35.6667029],[139.7010469,35.6667208],[139.7010999,35.6667305],[139.701123,35.6667348],[139.7012705,35.6667527],[139.7014794,35.6667731],[139.7015844,35.6667824],[139.7016813,35.6668651],[139.7016894,35.6668805],[139.7017377,35.6674415],[139.7018033,35.6680952],[139.7018282,35.6683743],[139.7018986,35.6687568],[139.7021583,35.6690891],[139.702325,35.6691596],[139.7028527,35.6693914],[139.7027896,35.6695729],[139.7029614,35.6695889],[139.7033195,35.6695031],[139.7037855,35.6692835],[139.7031649,35.6697423],[139.7031874,35.669755],[139.7033104,35.6698239],[139.7034243,35.6698064],[139.7035905,35.6698639],[139.7036363,35.6698718],[139.7036881,35.6698785],[139.7038786,35.6699354],[139.7040127,35.6699726],[139.7030793,35.6696652],[139.7029485,35.6697122],[139.702724,35.6697799],[139.7029485,35.6697122],[139.7029598,35.6694161],[139.7030967,35.669382],[139.703191,35.6693449],[139.7038798,35.669033],[139.7041712,35.6689],[139.7047319,35.6686409],[139.7051015,35.6684703],[139.7051462,35.6684101],[139.7051822,35.668365],[139.7052494,35.6683343],[139.705377,35.6682796]]};

        var test_fences = [{"name":"Simulation fence 1","foreign_id":"sim_geofence_1","area":0.661766163884749,"priority":1.0,"access_level":1000,"meta":null,"tags":[],"created_at":"2013-07-09T07:14:41Z","updated_at":"2013-07-11T05:27:24Z","id":"51dbb861ee4340a399000dcf","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf","shapes":[{"id":"51dbb882ee4340b9ed000dd0","type":"polygon","name":"sim_geofence_1_shape","points":[[139.701526,35.655605],[139.703135,35.655483],[139.703715,35.654332],[139.702642,35.653984],[139.700947,35.654385]],"holes":[],"radius":100,"generators":[[139.701526,35.655605],[139.703135,35.655483],[139.703715,35.654332],[139.702642,35.653984],[139.700947,35.654385]],"area":0.0310138473469124,"centroid":[139.702337154636,35.6547912764867],"nw_corner":[139.700947,35.655605],"se_corner":[139.703715,35.653984],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-09T07:15:14Z","updated_at":"2013-07-09T07:15:14Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dbb882ee4340b9ed000dd0"},{"id":"51dbb88fee4340f46c000dd2","type":"circle","name":"sim_geofence_1_shape","points":[[139.703606231048,35.666902],[139.703588107128,35.6670514976178],[139.70353443186,35.667195249862],[139.703447267954,35.6673277324598],[139.703329965071,35.6674438542472],[139.703187031093,35.6675391528091],[139.703023958895,35.6676099659552],[139.702847015249,35.667653572444],[139.702663,35.667668296548],[139.702478984751,35.667653572444],[139.702302041105,35.6676099659552],[139.702138968907,35.6675391528091],[139.70199603493,35.6674438542472],[139.701878732046,35.6673277324598],[139.70179156814,35.667195249862],[139.701737892872,35.6670514976178],[139.701719768952,35.666902],[139.701737892872,35.6667525021022],[139.70179156814,35.6666087490608],[139.701878732046,35.6664762652698],[139.70199603493,35.666360142075],[139.702138968907,35.6662648421057],[139.702302041105,35.6661940277664],[139.702478984751,35.6661504204803],[139.702663,35.6661356960964],[139.702847015249,35.6661504204803],[139.703023958895,35.6661940277664],[139.703187031093,35.6662648421057],[139.703329965071,35.666360142075],[139.703447267954,35.6664762652698],[139.70353443186,35.6666087490608],[139.703588107128,35.6667525021022]],"holes":[],"radius":105,"generators":[[139.702663,35.666902]],"area":0.0225392005449976,"centroid":[139.702634073056,35.6668946121614],"nw_corner":[139.701719768952,35.667668296548],"se_corner":[139.703606231048,35.6661356960964],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-09T07:15:27Z","updated_at":"2013-07-09T07:15:27Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dbb88fee4340f46c000dd2"},{"id":"51dbb891ee434031b7000dd3","type":"circle","name":"sim_geofence_1_shape","points":[[139.704623618533,35.66549],[139.704609464614,35.6656067526095],[139.704567546786,35.6657190183206],[139.704499475926,35.6658224828528],[139.70440786796,35.6659131701634],[139.70429624333,35.6659875952389],[139.704168891709,35.6660428980142],[139.704030707147,35.666076953276],[139.703887,35.6660884523274],[139.703743292853,35.666076953276],[139.703605108291,35.6660428980142],[139.70347775667,35.6659875952389],[139.70336613204,35.6659131701634],[139.703274524074,35.6658224828528],[139.703206453214,35.6657190183206],[139.703164535386,35.6656067526095],[139.703150381467,35.66549],[139.703164535386,35.6653732472198],[139.703206453214,35.6652609810224],[139.703274524074,35.6651575157626],[139.70336613204,35.6650668275936],[139.70347775667,35.6649924016597],[139.703605108291,35.6649370981568],[139.703743292853,35.6649030424088],[139.703887,35.6648915431866],[139.704030707147,35.6649030424088],[139.704168891709,35.6649370981568],[139.70429624333,35.6649924016597],[139.70440786796,35.6650668275936],[139.704499475926,35.6651575157626],[139.704567546786,35.6652609810224],[139.704609464614,35.6653732472198]],"holes":[],"radius":82,"generators":[[139.703887,35.66549]],"area":0.0137465943498682,"centroid":[139.70387719533,35.6654874955433],"nw_corner":[139.703150381467,35.6660884523274],"se_corner":[139.704623618533,35.6648915431866],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-09T07:15:29Z","updated_at":"2013-07-09T07:15:29Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dbb891ee434031b7000dd3"},{"id":"51dbb894ee4340a3b6000dd4","type":"circle","name":"sim_geofence_1_shape","points":[[139.704127978341,35.664078],[139.704107265289,35.6642488604411],[139.704045922126,35.6644131544665],[139.703946306233,35.6645645684081],[139.703812245795,35.6646972836017],[139.703648892678,35.6648061999816],[139.703462524451,35.6648871320568],[139.703260303142,35.6649369697418],[139.70305,35.6649537978616],[139.702839696858,35.6649369697418],[139.702637475548,35.6648871320568],[139.702451107322,35.6648061999816],[139.702287754205,35.6646972836017],[139.702153693767,35.6645645684081],[139.702054077874,35.6644131544665],[139.701992734711,35.6642488604411],[139.701972021659,35.664078],[139.701992734711,35.6639071391932],[139.702054077874,35.6637428441266],[139.702153693767,35.6635914286266],[139.702287754205,35.6634587115948],[139.702451107322,35.6633497933768],[139.702637475548,35.6632688597432],[139.702839696858,35.6632190210169],[139.70305,35.6632021925314],[139.703260303142,35.6632190210169],[139.703462524451,35.6632688597432],[139.703648892678,35.6633497933768],[139.703812245795,35.6634587115948],[139.703946306233,35.6635914286266],[139.704045922126,35.6637428441266],[139.704107265289,35.6639071391932]],"holes":[],"radius":120,"generators":[[139.70305,35.664078]],"area":0.0294399733365935,"centroid":[139.703058740346,35.6640802279384],"nw_corner":[139.701972021659,35.6649537978616],"se_corner":[139.704127978341,35.6632021925314],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-09T07:15:32Z","updated_at":"2013-07-09T07:15:32Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dbb894ee4340a3b6000dd4"},{"id":"51dd0b1eee434075ec0007d3","type":"circle","name":"sim_geofence_1_shape","points":[[139.69744491697,35.664377],[139.697413329566,35.6646375610505],[139.697319781242,35.6648881080841],[139.697167867006,35.6651190128564],[139.696963424837,35.6653214020329],[139.696714311334,35.6654874981542],[139.696430099789,35.6656109184829],[139.696121712291,35.6656869202511],[139.695801,35.6657125828913],[139.695480287709,35.6656869202511],[139.695171900211,35.6656109184829],[139.694887688666,35.6654874981542],[139.694638575163,35.6653214020329],[139.694434132994,35.6651190128564],[139.694282218758,35.6648881080841],[139.694188670434,35.6646375610505],[139.69415708303,35.664377],[139.694188670434,35.6641164380991],[139.694282218758,35.6638658886439],[139.694434132994,35.6636349802474],[139.694638575163,35.6634325867959],[139.694887688666,35.6632664863996],[139.695171900211,35.6631430624468],[139.695480287709,35.663067058257],[139.695801,35.6630413947664],[139.696121712291,35.663067058257],[139.696430099789,35.6631430624468],[139.696714311334,35.6632664863996],[139.696963424837,35.6634325867959],[139.697167867006,35.6636349802474],[139.697319781242,35.6638658886439],[139.697413329566,35.6641164380991]],"holes":[],"radius":183,"generators":[[139.695801,35.664377]],"area":0.0684661111881724,"centroid":[139.695789606918,35.6643740831574],"nw_corner":[139.69415708303,35.6657125828913],"se_corner":[139.69744491697,35.6630413947664],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:19:58Z","updated_at":"2013-07-10T07:19:58Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b1eee434075ec0007d3"},{"id":"51dd0b20ee4340a8340007d5","type":"circle","name":"sim_geofence_1_shape","points":[[139.698845186524,35.661553],[139.698816360861,35.6617907882006],[139.698730991625,35.6620194376662],[139.698592359508,35.6622301616407],[139.698405792065,35.6624148622919],[139.698178458977,35.6625664418797],[139.697919096528,35.6626790754883],[139.697637671872,35.6627484348429],[139.697345,35.6627718546173],[139.697052328128,35.6627484348429],[139.696770903472,35.6626790754883],[139.696511541023,35.6625664418797],[139.696284207936,35.6624148622919],[139.696097640492,35.6622301616407],[139.695959008375,35.6620194376662],[139.695873639139,35.6617907882006],[139.695844813476,35.661553],[139.695873639139,35.6613152110913],[139.695959008375,35.6610865596091],[139.696097640492,35.6608758326165],[139.696284207936,35.6606911284053],[139.696511541023,35.6605395452575],[139.696770903472,35.6604269086309],[139.697052328128,35.6603575472596],[139.697345,35.6603341267771],[139.697637671872,35.6603575472596],[139.697919096528,35.6604269086309],[139.698178458977,35.6605395452575],[139.698405792065,35.6606911284053],[139.698592359508,35.6608758326165],[139.698730991625,35.6610865596091],[139.698816360861,35.6613152110913]],"holes":[],"radius":167,"generators":[[139.697345,35.661553]],"area":0.0570192641134781,"centroid":[139.697352512511,35.661554910632],"nw_corner":[139.695844813476,35.6627718546173],"se_corner":[139.698845186524,35.6603341267771],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:20:00Z","updated_at":"2013-07-10T07:20:00Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b20ee4340a8340007d5"},{"id":"51dd0b21ee43409e490007d6","type":"circle","name":"sim_geofence_1_shape","points":[[139.703718580027,35.661657],[139.703683540448,35.6619460474632],[139.703579768263,35.6622239860077],[139.703411251378,35.6624801347807],[139.703184465803,35.6627046503821],[139.70290812678,35.6628889051028],[139.702592853864,35.6630258184365],[139.702250762815,35.6631101291343],[139.701895,35.6631385973529],[139.701539237185,35.6631101291343],[139.701197146136,35.6630258184365],[139.70088187322,35.6628889051028],[139.700605534197,35.6627046503821],[139.700378748622,35.6624801347807],[139.700210231737,35.6622239860077],[139.700106459552,35.6619460474632],[139.700071419973,35.661657],[139.700106459552,35.6613679514904],[139.700210231737,35.6610900099662],[139.700378748622,35.6608338567338],[139.700605534197,35.6606093358719],[139.70088187322,35.6604250758909],[139.701197146136,35.6602881580978],[139.701539237185,35.6602038444203],[139.701895,35.6601753751553],[139.702250762815,35.6602038444203],[139.702592853864,35.6602881580978],[139.70290812678,35.6604250758909],[139.703184465803,35.6606093358719],[139.703411251378,35.6608338567338],[139.703579768263,35.6610900099662],[139.703683540448,35.6613679514904]],"holes":[],"radius":203,"generators":[[139.701895,35.661657]],"area":0.0842520114065337,"centroid":[139.7018915789,35.6616561162958],"nw_corner":[139.700071419973,35.6631385973529],"se_corner":[139.703718580027,35.6601753751553],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:20:01Z","updated_at":"2013-07-10T07:20:01Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b21ee43409e490007d6"},{"id":"51dd0b24ee434000370007d7","type":"circle","name":"sim_geofence_1_shape","points":[[139.693526697957,35.662529],[139.693492866639,35.6628080772789],[139.693392672805,35.6630764288546],[139.693229966848,35.6633237422845],[139.693011001465,35.6635405136889],[139.692744191374,35.6637184129432],[139.692439789938,35.663850603758],[139.692109495131,35.6639320063509],[139.691766,35.6639594926241],[139.691422504869,35.6639320063509],[139.691092210063,35.663850603758],[139.690787808626,35.6637184129432],[139.690520998535,35.6635405136889],[139.690302033152,35.6633237422845],[139.690139327195,35.6630764288546],[139.690039133361,35.6628080772789],[139.690005302043,35.662529],[139.690039133361,35.6622499217456],[139.690139327195,35.6619815673921],[139.690302033152,35.6617342498049],[139.690520998535,35.6615174734967],[139.690787808626,35.6613395693385],[139.691092210063,35.6612073743665],[139.691422504869,35.6611259689957],[139.691766,35.6610984817471],[139.692109495131,35.6611259689957],[139.692439789938,35.6612073743665],[139.692744191374,35.6613395693385],[139.693011001465,35.6615174734967],[139.693229966848,35.6617342498049],[139.693392672805,35.6619815673921],[139.693492866639,35.6622499217456]],"holes":[],"radius":196,"generators":[[139.691766,35.662529]],"area":0.0785408583124081,"centroid":[139.691758167034,35.6625269908712],"nw_corner":[139.690005302043,35.6639594926241],"se_corner":[139.693526697957,35.6610984817471],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:20:04Z","updated_at":"2013-07-10T07:20:04Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b24ee434000370007d7"},{"id":"51dd0b26ee43407db30007d8","type":"circle","name":"sim_geofence_1_shape","points":[[139.700228567992,35.660092],[139.700213896247,35.6602130322254],[139.700170444839,35.6603294130773],[139.700099883582,35.6604366701345],[139.700004924105,35.6605306816128],[139.699889215647,35.6606078347566],[139.69975720482,35.6606651646661],[139.699613964725,35.6607004682295],[139.699465,35.6607123887806],[139.699316035275,35.6607004682295],[139.69917279518,35.6606651646661],[139.699040784353,35.6606078347566],[139.698925075895,35.6605306816128],[139.698830116418,35.6604366701345],[139.698759555161,35.6603294130773],[139.698716103753,35.6602130322254],[139.698701432009,35.660092],[139.698716103753,35.6599709675911],[139.698759555161,35.6598545862168],[139.698830116418,35.6597473283778],[139.698925075895,35.6596533159772],[139.699040784353,35.6595761619112],[139.69917279518,35.6595188312199],[139.699316035275,35.659483527134],[139.699465,35.6594716063995],[139.699613964725,35.659483527134],[139.69975720482,35.6595188312199],[139.699889215647,35.6595761619112],[139.700004924105,35.6596533159772],[139.700099883582,35.6597473283778],[139.700170444839,35.6598545862168],[139.700213896247,35.6599709675911]],"holes":[],"radius":85,"generators":[[139.699465,35.660092]],"area":0.0147718373546013,"centroid":[139.699466734095,35.6600924406985],"nw_corner":[139.698701432009,35.6607123887806],"se_corner":[139.700228567992,35.6594716063995],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:20:06Z","updated_at":"2013-07-10T07:20:09Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b26ee43407db30007d8"},{"id":"51dd0b5fee43404a5f000857","type":"circle","name":"sim_geofence_1_shape","points":[[139.691093090253,35.668073],[139.69108376938,35.6681498833964],[139.691056164957,35.6682238121371],[139.691011337805,35.6682919451942],[139.690951010608,35.6683516642703],[139.690877501705,35.6684006744161],[139.690793636003,35.6684370922204],[139.690702636414,35.6684595181853],[139.690608,35.6684670905055],[139.690513363586,35.6684595181853],[139.690422363997,35.6684370922204],[139.690338498295,35.6684006744161],[139.690264989392,35.6683516642703],[139.690204662195,35.6682919451942],[139.690159835043,35.6682238121371],[139.69013223062,35.6681498833964],[139.690122909747,35.668073],[139.69013223062,35.6679961165296],[139.690159835043,35.667922187578],[139.690204662195,35.6678540542054],[139.690264989392,35.667794334757],[139.690338498295,35.6677453242389],[139.690422363997,35.667708906119],[139.690513363586,35.6676864799433],[139.690608,35.667678907549],[139.690702636414,35.6676864799433],[139.690793636003,35.667708906119],[139.690877501705,35.6677453242389],[139.690951010608,35.667794334757],[139.691011337805,35.6678540542054],[139.691056164957,35.667922187578],[139.69108376938,35.6679961165296]],"holes":[],"radius":54,"generators":[[139.690608,35.668073]],"area":0.00596130023041042,"centroid":[139.690585934727,35.6680673658636],"nw_corner":[139.690122909747,35.6684670905055],"se_corner":[139.691093090253,35.667678907549],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:21:03Z","updated_at":"2013-07-10T07:21:03Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b5fee43404a5f000857"},{"id":"51dd0b66ee434005c6000859","type":"polygon","name":"sim_geofence_1_shape","points":[[139.689406,35.668177],[139.689621,35.666225],[139.689749,35.664516],[139.691681,35.664238],[139.692968,35.664377],[139.692968,35.665528],[139.690737,35.665388],[139.689964,35.667062],[139.689707,35.669223]],"holes":[],"radius":100,"generators":[[139.689406,35.668177],[139.689621,35.666225],[139.689749,35.664516],[139.691681,35.664238],[139.692968,35.664377],[139.692968,35.665528],[139.690737,35.665388],[139.689964,35.667062],[139.689707,35.669223]],"area":0.0545882535334385,"centroid":[139.690885740668,35.6655551139461],"nw_corner":[139.689406,35.669223],"se_corner":[139.692968,35.664238],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:21:10Z","updated_at":"2013-07-10T07:21:10Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0b66ee434005c6000859"},{"id":"51dd0c5bee434098f0000903","type":"polygon","name":"sim_geofence_1_shape","points":[[139.690565,35.669746],[139.692239,35.669921],[139.693655,35.669921],[139.693826,35.668665],[139.693183,35.66884],[139.692796,35.669467],[139.691852,35.669642],[139.690565,35.669154]],"holes":[],"radius":100,"generators":[[139.690565,35.669746],[139.692239,35.669921],[139.693655,35.669921],[139.693826,35.668665],[139.693183,35.66884],[139.692796,35.669467],[139.691852,35.669642],[139.690565,35.669154]],"area":0.0181176796650107,"centroid":[139.692508752022,35.6695049015325],"nw_corner":[139.690565,35.669921],"se_corner":[139.693826,35.668665],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:15Z","updated_at":"2013-07-10T07:25:15Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c5bee434098f0000903"},{"id":"51dd0c68ee4340c0a0000907","type":"circle","name":"sim_geofence_1_shape","points":[[139.693293309266,35.667619],[139.693286232307,35.6676773747693],[139.693265273393,35.6677335061887],[139.693231237963,35.6677852371662],[139.69318543398,35.6678305797196],[139.693129621665,35.6678677913723],[139.693065945854,35.6678954421134],[139.692996853573,35.667912469351],[139.692925,35.6679182187447],[139.692853146427,35.667912469351],[139.692784054146,35.6678954421134],[139.692720378335,35.6678677913723],[139.69266456602,35.6678305797196],[139.692618762037,35.6677852371662],[139.692584726607,35.6677335061887],[139.692563767693,35.6676773747693],[139.692556690733,35.667619],[139.692563767693,35.667560625188],[139.692584726607,35.667504493647],[139.692618762037,35.6674527624876],[139.69266456602,35.6674074197196],[139.692720378335,35.6673702078523],[139.692784054146,35.6673425569292],[139.692853146427,35.6673255295701],[139.692925,35.6673197801337],[139.692996853573,35.6673255295701],[139.693065945854,35.6673425569292],[139.693129621665,35.6673702078523],[139.69318543398,35.6674074197196],[139.693231237963,35.6674527624876],[139.693265273393,35.667504493647],[139.693286232307,35.667560625188]],"holes":[],"radius":41,"generators":[[139.692925,35.667619]],"area":0.00343656908626144,"centroid":[139.692750628416,35.6675744759906],"nw_corner":[139.692556690733,35.6679182187447],"se_corner":[139.693293309266,35.6673197801337],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:28Z","updated_at":"2013-07-10T07:25:28Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c68ee4340c0a0000907"},{"id":"51dd0c6aee4340ccb1000908","type":"circle","name":"sim_geofence_1_shape","points":[[139.692433669074,35.666783],[139.692420032982,35.6668954793538],[139.692379648733,35.6670036360397],[139.69231406827,35.6671033136825],[139.692225811815,35.6671906817649],[139.692118271013,35.6672623828256],[139.691995578597,35.6673156614785],[139.691862449568,35.6673484702932],[139.691724,35.6673595484712],[139.691585550432,35.6673484702932],[139.691452421403,35.6673156614785],[139.691329728987,35.6672623828256],[139.691222188185,35.6671906817649],[139.69113393173,35.6671033136825],[139.691068351267,35.6670036360397],[139.691027967018,35.6668954793538],[139.691014330926,35.666783],[139.691027967018,35.6666705204877],[139.691068351267,35.6665623633505],[139.69113393173,35.6664626850322],[139.691222188185,35.6663753161532],[139.691329728987,35.6663036142958],[139.691452421403,35.6662503349675],[139.691585550432,35.6662175257014],[139.691724,35.6662064473649],[139.691862449568,35.6662175257014],[139.691995578597,35.6662503349675],[139.692118271013,35.6663036142958],[139.692225811815,35.6663753161532],[139.69231406827,35.6664626850322],[139.692379648733,35.6665623633505],[139.692420032982,35.6666705204877]],"holes":[],"radius":79,"generators":[[139.691724,35.666783]],"area":0.0127589258863736,"centroid":[139.691762070822,35.6667927185599],"nw_corner":[139.691014330926,35.6673595484712],"se_corner":[139.692433669074,35.6662064473649],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:30Z","updated_at":"2013-07-10T07:25:30Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c6aee4340ccb1000908"},{"id":"51dd0c6cee434039ba000909","type":"circle","name":"sim_geofence_1_shape","points":[[139.688619691939,35.668909],[139.688596044539,35.669104053837],[139.688526011093,35.669291611415],[139.68841228295,35.6694644650786],[139.688259230616,35.6696159722741],[139.688072735807,35.6697403108013],[139.687859965415,35.6698327025366],[139.687629096087,35.6698895970331],[139.687389,35.6699088079444],[139.687148903913,35.6698895970331],[139.686918034584,35.6698327025366],[139.686705264193,35.6697403108013],[139.686518769384,35.6696159722741],[139.68636571705,35.6694644650786],[139.686251988906,35.669291611415],[139.686181955461,35.669104053837],[139.686158308061,35.668909],[139.686181955461,35.6687139456864],[139.686251988906,35.6685263867511],[139.68636571705,35.6683535310562],[139.686518769384,35.6682020214646],[139.686705264193,35.6680776805414],[139.686918034584,35.6679852867748],[139.687148903913,35.667928390921],[139.687389,35.6679091795331],[139.687629096087,35.667928390921],[139.687859965415,35.6679852867748],[139.688072735807,35.6680776805414],[139.688259230616,35.6682020214646],[139.68841228295,35.6683535310562],[139.688526011093,35.6685263867511],[139.688596044539,35.6687139456864]],"holes":[],"radius":137,"generators":[[139.687389,35.668909]],"area":0.0383698394989551,"centroid":[139.687375385843,35.6689055189445],"nw_corner":[139.686158308061,35.6699088079444],"se_corner":[139.688619691939,35.6679091795331],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:32Z","updated_at":"2013-07-10T07:25:32Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c6cee434039ba000909"},{"id":"51dd0c6dee434039ba00090a","type":"circle","name":"sim_geofence_1_shape","points":[[139.688046365826,35.666887],[139.688029622776,35.6670251073589],[139.687980037052,35.6671579071042],[139.687899514205,35.6672802958548],[139.687791148684,35.6673875703376],[139.687659104915,35.6674756081227],[139.687508457265,35.6675410260358],[139.687344995039,35.6675813101611],[139.687175,35.667594912441],[139.68700500496,35.6675813101611],[139.686841542735,35.6675410260358],[139.686690895085,35.6674756081227],[139.686558851316,35.6673875703376],[139.686450485795,35.6672802958548],[139.686369962948,35.6671579071042],[139.686320377224,35.6670251073589],[139.686303634174,35.666887],[139.686320377224,35.6667488924021],[139.686369962948,35.6666160919765],[139.686450485795,35.6664937022076],[139.686558851316,35.6663864265237],[139.686690895085,35.6662983875375],[139.686841542735,35.6662329686061],[139.68700500496,35.6661926838004],[139.687175,35.6661790812815],[139.687344995039,35.6661926838004],[139.687508457265,35.6662329686061],[139.687659104915,35.6662983875375],[139.687791148684,35.6663864265237],[139.687899514205,35.6664937022076],[139.687980037052,35.6666160919765],[139.688029622776,35.6667488924021]],"holes":[],"radius":97,"generators":[[139.687175,35.666887]],"area":0.0192354847877141,"centroid":[139.687180765076,35.6668884697404],"nw_corner":[139.686303634174,35.667594912441],"se_corner":[139.688046365826,35.6661790812815],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:32Z","updated_at":"2013-07-10T07:25:32Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c6dee434039ba00090a"},{"id":"51dd0c6eee43403a0400090c","type":"circle","name":"sim_geofence_1_shape","points":[[139.688725298437,35.6649],[139.688707864952,35.6650438060817],[139.688656234456,35.6651820855321],[139.68857239108,35.6653095243914],[139.688459556877,35.6654212253185],[139.688322068004,35.6655128957835],[139.68816520808,35.665581013016],[139.687995005144,35.6656229593717],[139.687818,35.6656371229177],[139.687640994856,35.6656229593717],[139.68747079192,35.665581013016],[139.687313931996,35.6655128957835],[139.687176443123,35.6654212253185],[139.68706360892,35.6653095243914],[139.686979765544,35.6651820855321],[139.686928135048,35.6650438060817],[139.686910701563,35.6649],[139.686928135048,35.6647561936592],[139.686979765544,35.6646179134712],[139.68706360892,35.664490473508],[139.687176443123,35.6643787712787],[139.687313931996,35.6642870995115],[139.68747079192,35.664218981175],[139.687640994856,35.6641770340817],[139.687818,35.6641628702766],[139.687995005144,35.6641770340817],[139.68816520808,35.664218981175],[139.688322068004,35.6642870995115],[139.688459556877,35.6643787712787],[139.68857239108,35.664490473508],[139.688656234456,35.6646179134712],[139.688707864952,35.6647561936592]],"holes":[],"radius":101,"generators":[[139.687818,35.6649]],"area":0.0208551514924693,"centroid":[139.687810396662,35.6648980561363],"nw_corner":[139.686910701563,35.6656371229177],"se_corner":[139.688725298437,35.6641628702766],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:34Z","updated_at":"2013-07-10T07:25:34Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c6eee43403a0400090c"},{"id":"51dd0c6fee4340ff1500090e","type":"circle","name":"sim_geofence_1_shape","points":[[139.690157348978,35.670374],[139.69014043332,35.6705135250501],[139.690090336403,35.6706476880007],[139.690008983424,35.6707713330845],[139.689899500732,35.6708797087494],[139.689766095687,35.670968650249],[139.689613894969,35.6710347396813],[139.689448747566,35.6710754373255],[139.689277,35.6710891792336],[139.689105252434,35.6710754373255],[139.688940105031,35.6710347396813],[139.688787904313,35.670968650249],[139.688654499267,35.6708797087494],[139.688545016576,35.6707713330845],[139.688463663597,35.6706476880007],[139.68841356668,35.6705135250501],[139.688396651022,35.670374],[139.68841356668,35.670234474706],[139.688463663597,35.6701003110608],[139.688545016576,35.6699766649376],[139.688654499267,35.6698682880467],[139.688787904313,35.669779345321],[139.688940105031,35.6697132548493],[139.689105252434,35.6696725565105],[139.689277,35.6696588143586],[139.689448747566,35.6696725565105],[139.689613894969,35.6697132548493],[139.689766095687,35.669779345321],[139.689899500732,35.6698682880467],[139.690008983424,35.6699766649376],[139.690090336403,35.6701003110608],[139.69014043332,35.670234474706]],"holes":[],"radius":98,"generators":[[139.689277,35.670374]],"area":0.0196332724772219,"centroid":[139.689299327598,35.670379699259],"nw_corner":[139.688396651022,35.6710891792336],"se_corner":[139.690157348978,35.6696588143586],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:35Z","updated_at":"2013-07-10T07:25:35Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c6fee4340ff1500090e"},{"id":"51dd0c74ee4340911300090f","type":"circle","name":"sim_geofence_1_shape","points":[[139.695529736463,35.668561],[139.695516790806,35.6686677818222],[139.695478451329,35.6687704599441],[139.695416191396,35.6688650885263],[139.695332403622,35.6689480310801],[139.695230307924,35.6690161002104],[139.695113827782,35.6690666800996],[139.694987439464,35.6690978270257],[139.694856,35.6691083440529],[139.694724560536,35.6690978270257],[139.694598172218,35.6690666800996],[139.694481692076,35.6690161002104],[139.694379596378,35.6689480310801],[139.694295808604,35.6688650885263],[139.694233548671,35.6687704599441],[139.694195209194,35.6686677818222],[139.694182263537,35.668561],[139.694195209194,35.668454218035],[139.694233548671,35.6683515395063],[139.694295808604,35.6682569103153],[139.694379596378,35.6681739670435],[139.694481692076,35.6681058971951],[139.694598172218,35.668055316697],[139.694724560536,35.6680241693642],[139.694856,35.6680136521942],[139.694987439464,35.6680241693642],[139.695113827782,35.668055316697],[139.695230307924,35.6681058971951],[139.695332403622,35.6681739670435],[139.695416191396,35.6682569103153],[139.695478451329,35.6683515395063],[139.695516790806,35.668454218035]],"holes":[],"radius":75,"generators":[[139.694856,35.668561]],"area":0.0114993451279588,"centroid":[139.694859508935,35.6685618946103],"nw_corner":[139.694182263537,35.6691083440529],"se_corner":[139.695529736463,35.6680136521942],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T07:25:40Z","updated_at":"2013-07-10T07:25:40Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd0c74ee4340911300090f"},{"id":"51dd25fdee4340c3e8001295","type":"polygon","name":"sim_geofence_1_shape","points":[[139.700907,35.665127],[139.701337,35.665963],[139.702538,35.665929],[139.702753,35.665231],[139.701787,35.664638]],"holes":[],"radius":100,"generators":[[139.700907,35.665127],[139.701337,35.665963],[139.702538,35.665929],[139.702753,35.665231],[139.701787,35.664638]],"area":0.0166020686810953,"centroid":[139.701853836126,35.6653769400717],"nw_corner":[139.700907,35.665963],"se_corner":[139.702753,35.664638],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-10T09:14:37Z","updated_at":"2013-07-10T09:14:37Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dd25fdee4340c3e8001295"},{"id":"51dbb88dee434013d0000dd1","type":"polygon","name":"sim_geofence_1_shape","points":[[139.698694,35.666711],[139.700239,35.666449],[139.700861,35.66556],[139.699788,35.664758],[139.698608,35.664688],[139.697857,35.665944]],"holes":[],"radius":100,"generators":[[139.698694,35.666711],[139.700239,35.666449],[139.700861,35.66556],[139.699788,35.664758],[139.698608,35.664688],[139.697857,35.665944]],"area":0.0409185754642749,"centroid":[139.699307878647,35.6656959322893],"nw_corner":[139.697857,35.666711],"se_corner":[139.700861,35.664688],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-09T07:15:25Z","updated_at":"2013-07-10T10:27:49Z","uri":"http://geo.skillupjapan.net/api/v3/geo_fences/51dbb861ee4340a399000dcf/shapes/51dbb88dee434013d0000dd1"}]}];

      function getNewPath() {
        // Make ajax call
        var xhReq = new XMLHttpRequest();
        xhReq.open("GET", "/?lon="+$('.lon').val()+"&lat="+$('.lat').val()+"&length="+$('.length').val(), false);
        xhReq.send(null);
        var serverResponse = xhReq.responseText;
        if (sim_debug) {
          var objJSON = fakeResponse;
        }
        else {
          var objJSON = JSON.parse(serverResponse);
        }

        // Update data
        path = [];
        objJSON['body'].forEach( function(p) {
          if (p) {
            path.push(new google.maps.LatLng(p[1],p[0]));
          }
          else{
            console.log(objJSON['body'])
          }
        });

        // Dumb refresh
        initialize();
        if (sim_debug) {
          update_circles();
          draw_fences();
        }
      }

      function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        map = new google.maps.Map(mapDiv, {
          center: new google.maps.LatLng($('.lat').val(),$('.lon').val()),
          zoom: 15,
          scaleControl: true,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
        };

        line = new google.maps.Polyline({
          path: path,
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          strokeColor: '#ff0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
      
        google.maps.LatLng.prototype.kmTo = function(a){ 
          var e = Math, ra = e.PI/180; 
          var b = this.lat() * ra, c = a.lat() * ra, d = b - c; 
          var g = this.lng() * ra - a.lng() * ra; 
          var f = 2 * e.asin(e.sqrt(e.pow(e.sin(d/2), 2) + e.cos(b) * e.cos(c) * e.pow(e.sin(g/2), 2))); 
          return f * 6378.137; 
        } 
        
        var inKm = function(n){ 
          var a = n, len = a.length, dist = 0; 
          for(var i=0; i<len-1; i++){ 
            dist += a[i].kmTo(a[i+1]); 
          } 
          return dist; 
        } 
      
        $('.info').html("Route length: "+inKm(path).toPrecision(4)+" Km");
        line.setMap(map);
      }

      function animateArrow(sense) {
        //var count = 0;
        //offsetId = window.setInterval(function() {
          if (sense == -1) {
            count = (count - 1) % 200;
          }
          else {
            count = (count + 1) % 200;
          }

          var icons = line.get('icons');
          icons[0].offset = (count / 2) + '%';
          line.set('icons', icons);
        //}, 250);
      }

      function draw_fences() {
        test_fences[0]['shapes'].forEach( function(s) {
          shapepath = [];
          s['points'].forEach( function(p) {
            if (p) {
              shapepath.push(new google.maps.LatLng(p[1],p[0]));
            }
            else{
              console.log(objJSON['body'])
            }
          });

          // Draw shape
          var shapeOptions = {
            strokeColor: "#0F0F0F",
            strokeOpacity: 0.15,
            strokeWeight: 1,
            fillColor: "#0F0F0F",
            fillOpacity: 0.15,
            map: map,
            path: shapepath
          };
          var shape = new google.maps.Polygon(shapeOptions);

          shape.setMap(map);
        });
      }

      function update_circles() {
        // Bounding check for buttons
        if (step < 0 ) {
          step = 0;
          return;
        }
        if (step >= test_circlesRAW.length ) {
          step = test_circlesRAW.length;
          return;
        }

        // Delete previous circles
        drawn_circles.forEach( function(c) {
          c.setMap(null);
        });

        // Draw each of the new circles
        var test_circles = test_circlesRAW[step];
        //for (var i=0; i<test_circles.length; i++) {
        test_circles['centers'].forEach( function(p) {
          if (p) {
            point = new google.maps.LatLng(p[1],p[0]);

            var col = null;
            if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#FF0000";
            }
            else if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#00FF00";
            }
            else {
              col = "#0000FF";
            }

            // Draw circles
            var populationOptions = {
              strokeColor: col,
              strokeOpacity: 0.6,
              strokeWeight: 1,
              fillColor: col,
              fillOpacity: 0.35,
              map: map,
              center: point,
              radius: test_circles['radii'][test_circles['centers'].indexOf(p)]*0.81
            };
            var c = new google.maps.Circle(populationOptions);
            drawn_circles.push(c);

          }
          else{
            console.log(test_circles['centers'])
          }
        //}
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body style="font-family: Arial; border: 0 none;">
    <div id="map-canvas" style="width: 800px; height: 400px"></div>
    <div>
      Position: 
      <button onclick='animateArrow(-1);' type="button">&lt;</button>
      <button onclick='animateArrow(1);' type="button">&gt;</button>
      <br>
      Request:
      <button onclick='if (sim_debug) { step -= 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&lt;</button>
      <button onclick='if (sim_debug) { step += 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&gt;</button>
      <br>
      Lon: <input class="lon" type="text" name="lon" value="139.698345">
      Lat: <input class="lat" type="text" name="lat" value="35.666641">
      Length: <input class="length" type="text" name="length" value="2000">m
      <br>
      <input type="submit" onclick="getNewPath()" value="Get new route">
    </div>
    <div class="info"></div>
  </body>
</html>
