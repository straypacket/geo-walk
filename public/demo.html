<!--
You are free to copy and use this sample in accordance with the terms of the
Apache license (http://www.apache.org/licenses/LICENSE-2.0.html)
-->

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>SUJ Geo walks</title>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
    <script type="text/javascript">

      var path = [];
      var map = null;
      var line = null;
      var drawn_circles = [];
      var step = 0;
      var count = 0;
      var sim_debug = true;

      var test_circlesRAW = [{"centers": [[139.691848754883, 35.6664276123047], [139.694595336914, 35.6664276123047], [139.693222045898, 35.6650543212891]], "radii": [94.3650146546261, 94.3650146546261, 283.095043963878], "type": ["ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.689102172852, 35.6650543212891], [139.690475463867, 35.6650543212891], [139.690475463867, 35.6636810302734]], "radii": [94.3650146546261, 94.3650146546261, 283.095043963878], "type": ["ARRIVING", "ARRIVING", "LEAVING"]}, {"centers": [[139.689102172852, 35.6650543212891], [139.687728881836, 35.6636810302734]], "radii": [94.3650146546261, 283.095043963878], "type": ["ARRIVING", "LEAVING"]}, {"centers": [[139.684982299805, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.682235717773, 35.6636810302734]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.680862426758, 35.6609344482422]], "radii": [283.095043963878], "type": ["LEAVING"]}, {"centers": [[139.680862426758, 35.6581878662109]], "radii": [283.095043963878], "type": ["LEAVING"]}];

        var fakeResponse = {"distance":0.01989326090392547,"body":[[139.6931389,35.6646286],[139.6919671,35.6643263],[139.6914338,35.664197],[139.6910844,35.6641088],[139.6906986,35.6639866],[139.6906986,35.6639866],[139.6900109,35.6637591],[139.689662,35.6636454],[139.6892554,35.6635123],[139.6888693,35.6634024],[139.6885112,35.6632988],[139.6881277,35.6631882],[139.6877773,35.6630872],[139.6875882,35.6631161],[139.6866202,35.6634698],[139.6857199,35.6637674],[139.6851912,35.6639589],[139.6849855,35.6640462],[139.6844678,35.6642107],[139.6841017,35.664287],[139.6835831,35.6645003],[139.6837089,35.6646945],[139.6835831,35.6645003],[139.6834242,35.6642439],[139.6832056,35.6638939],[139.6831685,35.663823],[139.6831347,35.6637727],[139.6828406,35.6633348],[139.6819606,35.6632686],[139.6818069,35.6627893],[139.6816986,35.6623696],[139.6813961,35.6611566],[139.6812937,35.660752],[139.681036,35.6597346],[139.6817234,35.6585116],[139.6815559,35.6586437],[139.6813536,35.6585253],[139.6814766,35.6580408],[139.6814618,35.6579626],[139.6813806,35.6579689],[139.6813236,35.6573295],[139.6813431,35.6570857],[139.6813627,35.6568435],[139.6813932,35.6566003],[139.6807794,35.6566208],[139.6807868,35.6569207],[139.680794,35.6569738],[139.6808776,35.6575924],[139.6808606,35.6576201],[139.6798737,35.6576947]]};

        var test_fences = [{"name":"Simulation density 1.0","foreign_id":"density_1_0","area":1.26878958295038,"priority":1.0,"access_level":1000,"meta":null,"tags":[],"created_at":"2013-07-18T02:17:14Z","updated_at":"2013-07-18T02:18:37Z","id":"51e7502a0bc24dca59000273","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273","shapes":[{"id":"51e7502a3b004899f081ac5f","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.688601,35.664774]],"area":0.0204442438325714,"centroid":[139.688618560953,35.6647784815878],"nw_corner":[139.687702684716,35.6655038258562],"se_corner":[139.689499315284,35.6640441674723],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:39Z","updated_at":"2013-07-18T02:16:39Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5f"},{"id":"51e7502a3b004899f081ac60","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.694974,35.664809]],"area":0.0204442483754974,"centroid":[139.694960803106,35.6648056280687],"nw_corner":[139.694075684716,35.6655388255362],"se_corner":[139.695872315284,35.6640791677922],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:40Z","updated_at":"2013-07-18T02:16:40Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac60"},{"id":"51e7502a3b004899f081ac61","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.695039,35.662874]],"area":0.0204447344685832,"centroid":[139.695047183897,35.6628760867627],"nw_corner":[139.694140684716,35.6636038432243],"se_corner":[139.695937315284,35.6621441501043],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:41Z","updated_at":"2013-07-18T02:16:41Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac61"},{"id":"51e7502a3b004899f081ac62","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.692142,35.663136]],"area":0.0204446799534708,"centroid":[139.692121551596,35.6631307772085],"nw_corner":[139.691243684716,35.6638658408293],"se_corner":[139.693040315284,35.6624061524992],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:42Z","updated_at":"2013-07-18T02:16:42Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac62"},{"id":"51e7502a3b004899f081ac67","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.695232,35.663868]],"area":0.0204444800647252,"centroid":[139.695239912069,35.6638700175519],"nw_corner":[139.694333684716,35.6645978341381],"se_corner":[139.696130315284,35.6631381591904],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:06:17Z","updated_at":"2013-07-18T02:06:17Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac67"},{"id":"51e7502a3b004899f081ac68","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.691441,35.665368]],"area":0.0204440984589382,"centroid":[139.691443228567,35.6653685665865],"nw_corner":[139.690542684716,35.6660978204262],"se_corner":[139.692339315284,35.6646381729022],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:00:24Z","updated_at":"2013-07-18T02:00:24Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac68"},{"id":"51e7502a3b004899f081ac46","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.689159,35.66324]],"area":0.0204446390671364,"centroid":[139.689171020673,35.6632430664862],"nw_corner":[139.688260684716,35.6639698398787],"se_corner":[139.690057315284,35.6625101534499],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:11:25Z","updated_at":"2013-07-18T02:11:25Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac46"},{"id":"51e7502a3b004899f081ac47","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.686391,35.664513]],"area":0.0204443119764619,"centroid":[139.686405577998,35.664516719048],"nw_corner":[139.685492684716,35.6652428282421],"se_corner":[139.687289315284,35.6637831650864],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:12:05Z","updated_at":"2013-07-18T02:12:05Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac47"},{"id":"51e7502a3b004899f081ac48","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.692099,35.662229]],"area":0.0204448934709944,"centroid":[139.692121197728,35.6622346645321],"nw_corner":[139.691200684716,35.6629588491201],"se_corner":[139.692997315284,35.6614991442086],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:03:12Z","updated_at":"2013-07-18T02:03:12Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac48"},{"id":"51e7502a3b004899f081ac49","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.699938,35.664148]],"area":0.0204444346354649,"centroid":[139.699886080732,35.6641347432423],"nw_corner":[139.699039684716,35.6648778315786],"se_corner":[139.700836315284,35.6634181617499],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:09:22Z","updated_at":"2013-07-18T02:09:22Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac49"},{"id":"51e7502a3b004899f081ac59","type":"circle","name":"density_0_2_shape","points":[],"holes":[],"radius":100,"generators":[[139.698923,35.66317]],"area":0.0204446436100625,"centroid":[139.698965498831,35.6631808469142],"nw_corner":[139.698024684716,35.6638998405186],"se_corner":[139.699821315284,35.66244015281],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:01:37Z","updated_at":"2013-07-18T02:01:37Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac59"},{"id":"51e7502a3b004899f081ac5a","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.688301,35.662212]],"area":0.0204448980139205,"centroid":[139.688322762949,35.6622175539196],"nw_corner":[139.687402684716,35.6629418492754],"se_corner":[139.689199315284,35.6614821440532],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:03:11Z","updated_at":"2013-07-18T02:03:11Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5a"},{"id":"51e7502a3b004899f081ac5b","type":"circle","name":"density_0_2_shape","points":[],"holes":[],"radius":100,"generators":[[139.696562,35.662874]],"area":0.0204447390115092,"centroid":[139.696559837109,35.6628734449588],"nw_corner":[139.695663684716,35.6636038432243],"se_corner":[139.697460315284,35.6621441501043],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:02:01Z","updated_at":"2013-07-18T02:02:01Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5b"},{"id":"51e7502a3b004899f081ac55","type":"circle","name":"density_0_2_shape","points":[],"holes":[],"radius":100,"generators":[[139.698815,35.665384]],"area":0.0204440939160122,"centroid":[139.698818244791,35.6653848257967],"nw_corner":[139.697916684716,35.66611382028],"se_corner":[139.699713315284,35.6646541730484],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:01:38Z","updated_at":"2013-07-18T02:01:38Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac55"},{"id":"51e7502a3b004899f081ac56","type":"circle","name":"density_0_2_shape","points":[],"holes":[],"radius":100,"generators":[[139.685254,35.665472]],"area":0.020444066658456,"centroid":[139.685268001926,35.6654755728074],"nw_corner":[139.684355684716,35.6662018194755],"se_corner":[139.686152315284,35.6647421738529],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:01:41Z","updated_at":"2013-07-18T02:01:41Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac56"},{"id":"51e7502a3b004899f081ac57","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.685511,35.663589]],"area":0.0204445482086157,"centroid":[139.685526421376,35.6635929346261],"nw_corner":[139.684612684716,35.6643188366885],"se_corner":[139.686409315284,35.66285915664],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:04:33Z","updated_at":"2013-07-18T02:04:33Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac57"},{"id":"51e7502a3b004899f081ac58","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.687164,35.662996]],"area":0.020444711753953,"centroid":[139.687152771027,35.6629931305472],"nw_corner":[139.686265684716,35.6637258421091],"se_corner":[139.688062315284,35.6622661512195],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:12:06Z","updated_at":"2013-07-18T02:12:06Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac58"},{"id":"51e750620bc24dca59000277","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.698729,35.666378]],"area":0.0204438395121542,"centroid":[139.698731937379,35.6663787476782],"nw_corner":[139.697830684716,35.6671078111933],"se_corner":[139.699627315284,35.665648182135],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:10Z","updated_at":"2013-07-18T02:18:10Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750620bc24dca59000277"},{"id":"51e750640bc24dca59000278","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.696369,35.664042]],"area":0.0204444300925388,"centroid":[139.696389251695,35.6640471681744],"nw_corner":[139.695470684716,35.6647718325476],"se_corner":[139.697267315284,35.6633121607809],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:12Z","updated_at":"2013-07-18T02:18:12Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750640bc24dca59000278"},{"id":"51e750670bc24dca59000279","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.698858,35.664234]],"area":0.0204443801203524,"centroid":[139.698880091708,35.6642396371859],"nw_corner":[139.697959684716,35.6649638307924],"se_corner":[139.699756315284,35.663504162536],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:15Z","updated_at":"2013-07-18T02:18:15Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750670bc24dca59000279"},{"id":"51e750750bc24dca59000281","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.700553,35.663327]],"area":0.0204446254383583,"centroid":[139.700545323268,35.6633250382104],"nw_corner":[139.699654684716,35.6640568390834],"se_corner":[139.701451315284,35.6625971542451],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:29Z","updated_at":"2013-07-18T02:18:29Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750750bc24dca59000281"},{"id":"51e7502a3b004899f081ac70","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.692979,35.664687]],"area":0.0204442665472016,"centroid":[139.692995567959,35.6646912273285],"nw_corner":[139.692080684716,35.6654168266515],"se_corner":[139.693877315284,35.663957166677],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:31Z","updated_at":"2013-07-18T02:15:31Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac70"},{"id":"51e7502a3b004899f081ac71","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.690146,35.661985]],"area":0.0204449479861069,"centroid":[139.690186329431,35.6619952932675],"nw_corner":[139.689247684716,35.6627148513504],"se_corner":[139.691044315284,35.6612551419783],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:07:43Z","updated_at":"2013-07-18T02:07:43Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac71"},{"id":"51e7502a3b004899f081ac72","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.686885,35.665855]],"area":0.0204439712570093,"centroid":[139.686892909368,35.6658570167276],"nw_corner":[139.685986684716,35.6665848159743],"se_corner":[139.687783315284,35.665125177354],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:07:16Z","updated_at":"2013-07-18T02:07:16Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac72"},{"id":"51e7502a3b004899f081ac4e","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.69933,35.662002]],"area":0.020444961614885,"centroid":[139.699329376285,35.6620018381069],"nw_corner":[139.698431684716,35.662731851195],"se_corner":[139.700228315284,35.6612721421336],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:02Z","updated_at":"2013-07-18T02:15:02Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4e"},{"id":"51e7502a3b004899f081ac4f","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.69742,35.666239]],"area":0.0204438667697104,"centroid":[139.697441927199,35.6662445956436],"nw_corner":[139.696521684716,35.6669688124639],"se_corner":[139.698318315284,35.6655091808643],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:07:13Z","updated_at":"2013-07-18T02:07:13Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4f"},{"id":"51e7502a3b004899f081ac5c","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.697878,35.661951]],"area":0.0204450025012193,"centroid":[139.697813994605,35.6619346583361],"nw_corner":[139.696979684716,35.6626808516612],"se_corner":[139.698776315284,35.6612211416675],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:09:18Z","updated_at":"2013-07-18T02:09:18Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5c"},{"id":"51e7502a3b004899f081ac5d","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.702727,35.662003]],"area":0.0204449752436631,"centroid":[139.702694750076,35.661994765146],"nw_corner":[139.701828684716,35.6627328511859],"se_corner":[139.703625315284,35.6612731421428],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:09:20Z","updated_at":"2013-07-18T02:09:20Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5d"},{"id":"51e7502a3b004899f081ac5e","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.700897,35.665175]],"area":0.0204441484311246,"centroid":[139.700897976038,35.6651752465556],"nw_corner":[139.699998684716,35.6659048221905],"se_corner":[139.701795315284,35.6644451711379],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:05:44Z","updated_at":"2013-07-18T02:05:44Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac5e"},{"id":"51e7502a3b004899f081ac63","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.691048,35.664408]],"area":0.0204443483198702,"centroid":[139.69104103933,35.6644062204473],"nw_corner":[139.690149684716,35.6651378292019],"se_corner":[139.691946315284,35.6636781641266],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:54Z","updated_at":"2013-07-18T02:16:54Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac63"},{"id":"51e7502a3b004899f081ac64","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.694888,35.661967]],"area":0.020444966157811,"centroid":[139.694897440894,35.6619694075356],"nw_corner":[139.693989684716,35.6626968515149],"se_corner":[139.695786315284,35.6612371418137],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:05:42Z","updated_at":"2013-07-18T02:05:42Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac64"},{"id":"51e7502a3b004899f081ac65","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.687815,35.664148]],"area":0.0204444164637607,"centroid":[139.687804471194,35.6641453099351],"nw_corner":[139.686916684716,35.6648778315786],"se_corner":[139.688713315284,35.6634181617499],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:00:39Z","updated_at":"2013-07-18T02:00:39Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac65"},{"id":"51e7502a3b004899f081ac66","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.686262,35.662212]],"area":0.0204448980139205,"centroid":[139.686283764216,35.6622175536664],"nw_corner":[139.685363684716,35.6629418492754],"se_corner":[139.687160315284,35.6614821440532],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:08:11Z","updated_at":"2013-07-18T02:08:11Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac66"},{"id":"51e7502a3b004899f081ac73","type":"circle","name":"density_0_9_shape","points":[],"holes":[],"radius":100,"generators":[[139.697399,35.665262]],"area":0.0204441257164945,"centroid":[139.697400969493,35.6652625002654],"nw_corner":[139.696500684716,35.6659918213952],"se_corner":[139.698297315284,35.6645321719332],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:16:37Z","updated_at":"2013-07-18T02:16:37Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac73"},{"id":"51e7502a3b004899f081ac74","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.701755,35.663728]],"area":0.0204445254939856,"centroid":[139.701741089711,35.6637244467782],"nw_corner":[139.700856684716,35.6644578354179],"se_corner":[139.702653315284,35.6629981579106],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:03:44Z","updated_at":"2013-07-18T02:03:44Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac74"},{"id":"51e7502a3b004899f081ac75","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.697549,35.664286]],"area":0.0204443755774264,"centroid":[139.697551110656,35.6642865361819],"nw_corner":[139.696650684716,35.6650158303171],"se_corner":[139.698447315284,35.6635561630113],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:05:43Z","updated_at":"2013-07-18T02:05:43Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac75"},{"id":"51e7502a3b004899f081ac76","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.688558,35.665785]],"area":0.0204439985145655,"centroid":[139.688544654928,35.6657815900296],"nw_corner":[139.687659684716,35.6665148166142],"se_corner":[139.689456315284,35.6650551767141],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:03:09Z","updated_at":"2013-07-18T02:03:09Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac76"},{"id":"51e7502a3b004899f081ac42","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.692099,35.664077]],"area":0.0204444255496128,"centroid":[139.692109185752,35.6640795977612],"nw_corner":[139.691200684716,35.6648068322276],"se_corner":[139.692997315284,35.6633471611008],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:07:18Z","updated_at":"2013-07-18T02:07:18Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac42"},{"id":"51e7502a3b004899f081ac43","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.689824,35.664565]],"area":0.020444321062314,"centroid":[139.689787557512,35.6645556932268],"nw_corner":[139.688925684716,35.6652948277667],"se_corner":[139.690722315284,35.6638351655617],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:05:40Z","updated_at":"2013-07-18T02:05:40Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac43"},{"id":"51e7502a3b004899f081ac44","type":"circle","name":"density_0_2_shape","points":[],"holes":[],"radius":100,"generators":[[139.690747,35.66331]],"area":0.0204446436100625,"centroid":[139.690707850136,35.6633000029859],"nw_corner":[139.689848684716,35.6640398392388],"se_corner":[139.691645315284,35.6625801540897],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:01:36Z","updated_at":"2013-07-18T02:01:36Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac44"},{"id":"51e7502a3b004899f081ac45","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.700124,35.666308]],"area":0.0204438440550803,"centroid":[139.70015741973,35.6663165297141],"nw_corner":[139.699225684716,35.6670378118332],"se_corner":[139.701022315284,35.6655781814951],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:11:21Z","updated_at":"2013-07-18T02:11:21Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac45"},{"id":"51e750760bc24dca59000282","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.696133,35.666291]],"area":0.0204438622267844,"centroid":[139.696134944331,35.6662914939118],"nw_corner":[139.695234684716,35.6670208119886],"se_corner":[139.697031315284,35.6655611813397],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:30Z","updated_at":"2013-07-18T02:18:30Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750760bc24dca59000282"},{"id":"51e750790bc24dca59000283","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.689974,35.665402]],"area":0.0204440802872341,"centroid":[139.689997787521,35.6654080711551],"nw_corner":[139.689075684716,35.6661318201154],"se_corner":[139.690872315284,35.664672173213],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:33Z","updated_at":"2013-07-18T02:18:33Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750790bc24dca59000283"},{"id":"51e7502a3b004899f081ac77","type":"circle","name":"density_0_5_shape","points":[],"holes":[],"radius":100,"generators":[[139.69285,35.666117]],"area":0.0204439121989708,"centroid":[139.69283961139,35.6661143455414],"nw_corner":[139.691951684716,35.6668468135792],"se_corner":[139.693748315284,35.6653871797491],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:07:31Z","updated_at":"2013-07-18T02:07:31Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac77"},{"id":"51e750600bc24dca59000275","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.686026,35.666587]],"area":0.0204437759111897,"centroid":[139.686051895841,35.6665936104111],"nw_corner":[139.685127684716,35.6673168092826],"se_corner":[139.686924315284,35.6658571840456],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:08Z","updated_at":"2013-07-18T02:18:08Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750600bc24dca59000275"},{"id":"51e750610bc24dca59000276","type":"circle","name":"density_1_0_shape","points":[],"holes":[],"radius":100,"generators":[[139.691562,35.666482]],"area":0.0204438167975241,"centroid":[139.691556014627,35.6664804692958],"nw_corner":[139.690663684716,35.6672118102425],"se_corner":[139.692460315284,35.6657521830858],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:18:09Z","updated_at":"2013-07-18T02:18:09Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e750610bc24dca59000276"},{"id":"51e7502a3b004899f081ac69","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.702684,35.664775]],"area":0.0204442392896453,"centroid":[139.702711328118,35.6647819741491],"nw_corner":[139.701785684716,35.6655048258471],"se_corner":[139.703582315284,35.6640451674814],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:10:06Z","updated_at":"2013-07-18T02:10:06Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac69"},{"id":"51e7502a3b004899f081ac6a","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.695003,35.66624]],"area":0.0204438894843406,"centroid":[139.694972607568,35.6662322377167],"nw_corner":[139.694104684716,35.6669698124548],"se_corner":[139.695901315284,35.6655101808735],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:10:02Z","updated_at":"2013-07-18T02:10:02Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6a"},{"id":"51e7502a3b004899f081ac6b","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.690168,35.666308]],"area":0.0204438531409323,"centroid":[139.690180724428,35.6663112464098],"nw_corner":[139.689269684716,35.6670378118332],"se_corner":[139.691066315284,35.6655781814951],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:11:17Z","updated_at":"2013-07-18T02:11:17Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6b"},{"id":"51e7502a3b004899f081ac6c","type":"circle","name":"density_0_7_shape","points":[],"holes":[],"radius":100,"generators":[[139.684267,35.666448]],"area":0.020443807711672,"centroid":[139.684301538297,35.6664568165796],"nw_corner":[139.683368684716,35.6671778105533],"se_corner":[139.685165315284,35.6657181827749],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:11:19Z","updated_at":"2013-07-18T02:11:19Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6c"},{"id":"51e7502a3b004899f081ac6d","type":"circle","name":"density_0_4_shape","points":[],"holes":[],"radius":100,"generators":[[139.700596,35.662386]],"area":0.0204448571275861,"centroid":[139.700609413178,35.6623894219811],"nw_corner":[139.699697684716,35.663115847685],"se_corner":[139.701494315284,35.6616561456436],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:05:45Z","updated_at":"2013-07-18T02:05:45Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6d"},{"id":"51e7502a3b004899f081ac6e","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.696391,35.662054]],"area":0.0204449161856246,"centroid":[139.696463520375,35.6620725106048],"nw_corner":[139.695492684716,35.6627838507197],"se_corner":[139.697289315284,35.6613241426089],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:20Z","updated_at":"2013-07-18T02:15:20Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6e"},{"id":"51e7502a3b004899f081ac6f","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.684353,35.663118]],"area":0.0204446708676187,"centroid":[139.684363741178,35.6631207399893],"nw_corner":[139.683454684716,35.6638478409939],"se_corner":[139.685251315284,35.6623881523347],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:26Z","updated_at":"2013-07-18T02:15:26Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac6f"},{"id":"51e7502a3b004899f081ac4a","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.697699,35.66324]],"area":0.0204446526959146,"centroid":[139.697679980162,35.6632351418633],"nw_corner":[139.696800684716,35.6639698398787],"se_corner":[139.698597315284,35.6625101534499],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:33Z","updated_at":"2013-07-18T02:15:33Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4a"},{"id":"51e7502a3b004899f081ac4b","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.696054,35.665246]],"area":0.0204441302594205,"centroid":[139.696054954533,35.6652462413246],"nw_corner":[139.695155684716,35.6659758215415],"se_corner":[139.696952315284,35.6645161717869],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:00:26Z","updated_at":"2013-07-18T02:00:26Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4b"},{"id":"51e7502a3b004899f081ac4c","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.702849,35.663188]],"area":0.0204446572388406,"centroid":[139.702849960007,35.6631882422719],"nw_corner":[139.701950684716,35.663917840354],"se_corner":[139.703747315284,35.6624581529746],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:14:57Z","updated_at":"2013-07-18T02:14:57Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4c"},{"id":"51e7502a3b004899f081ac4d","type":"circle","name":"density_0_8_shape","points":[],"holes":[],"radius":100,"generators":[[139.693408,35.662124]],"area":0.0204449298144027,"centroid":[139.693408656992,35.6621241651021],"nw_corner":[139.692509684716,35.6628538500798],"se_corner":[139.694306315284,35.6613941432488],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:15:00Z","updated_at":"2013-07-18T02:15:00Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac4d"},{"id":"51e7502a3b004899f081ac50","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":102,"generators":[[139.702495,35.666306]],"area":0.0212697934375683,"centroid":[139.702489996875,35.6663047203102],"nw_corner":[139.70157871841,35.6670504080204],"se_corner":[139.70341128159,35.6655615850383],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T01:59:51Z","updated_at":"2013-07-18T01:59:56Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac50"},{"id":"51e7502a3b004899f081ac51","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":100,"generators":[[139.693522,35.663328]],"area":0.0204446208954323,"centroid":[139.693524087318,35.6633285301846],"nw_corner":[139.692623684716,35.6640578390743],"se_corner":[139.694420315284,35.6625981542543],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:00:27Z","updated_at":"2013-07-18T02:00:27Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac51"},{"id":"51e7502a3b004899f081ac52","type":"circle","name":"density_0_6_shape","points":[],"holes":[],"radius":100,"generators":[[139.684274,35.664374]],"area":0.0204443574057223,"centroid":[139.684266175549,35.6643719998296],"nw_corner":[139.683375684716,35.6651038295127],"se_corner":[139.685172315284,35.6636441638158],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:09:14Z","updated_at":"2013-07-18T02:09:14Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac52"},{"id":"51e7502a3b004899f081ac53","type":"circle","name":"density_0_1_shape","points":[],"holes":[],"radius":101,"generators":[[139.684224,35.662107]],"area":0.0208558647318569,"centroid":[139.684252813819,35.6621143535959],"nw_corner":[139.683316701563,35.6628441487039],"se_corner":[139.685131298437,35.6613698444907],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T01:59:50Z","updated_at":"2013-07-18T01:59:58Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac53"},{"id":"51e7502a3b004899f081ac54","type":"circle","name":"density_0_3_shape","points":[],"holes":[],"radius":100,"generators":[[139.693944,35.66521]],"area":0.0204441257164945,"centroid":[139.693976298692,35.6652182435154],"nw_corner":[139.693045684716,35.6659398218706],"se_corner":[139.694842315284,35.6644801714579],"access_level":1000,"meta":null,"start_time":null,"finish_time":null,"active":true,"enabled":true,"created_at":"2013-07-18T02:03:13Z","updated_at":"2013-07-18T02:03:13Z","uri":"http://192.168.13.138:3000/api/v3/geo_fences/51e7502a0bc24dca59000273/shapes/51e7502a3b004899f081ac54"}]}];

      function getNewPath() {
        // Make ajax call
        var xhReq = new XMLHttpRequest();
        xhReq.open("GET", "/?lon="+$('.lon').val()+"&lat="+$('.lat').val()+"&length="+$('.length').val(), false);
        xhReq.send(null);
        var serverResponse = xhReq.responseText;
        if (sim_debug) {
          var objJSON = fakeResponse;
        }
        else {
          var objJSON = JSON.parse(serverResponse);
        }

        // Update data
        path = [];
        objJSON['body'].forEach( function(p) {
          if (p) {
            path.push(new google.maps.LatLng(p[1],p[0]));
          }
          else{
            console.log(objJSON['body'])
          }
        });

        // Dumb refresh
        initialize();
        if (sim_debug) {
          update_circles();
          draw_circle_fences();
        }
      }

      function initialize() {
        var mapDiv = document.getElementById('map-canvas');
        map = new google.maps.Map(mapDiv, {
          center: new google.maps.LatLng($('.lat').val(),$('.lon').val()),
          zoom: 15,
          scaleControl: true,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        var lineSymbol = {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW
        };

        line = new google.maps.Polyline({
          path: path,
          icons: [{
            icon: lineSymbol,
            offset: '100%'
          }],
          strokeColor: '#ff0000',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });
      
        google.maps.LatLng.prototype.kmTo = function(a){ 
          var e = Math, ra = e.PI/180; 
          var b = this.lat() * ra, c = a.lat() * ra, d = b - c; 
          var g = this.lng() * ra - a.lng() * ra; 
          var f = 2 * e.asin(e.sqrt(e.pow(e.sin(d/2), 2) + e.cos(b) * e.cos(c) * e.pow(e.sin(g/2), 2))); 
          return f * 6378.137; 
        } 
        
        var inKm = function(n){ 
          var a = n, len = a.length, dist = 0; 
          for(var i=0; i<len-1; i++){ 
            dist += a[i].kmTo(a[i+1]); 
          } 
          return dist; 
        } 
      
        $('.info').html("Route length: "+inKm(path).toPrecision(4)+" Km");
        line.setMap(map);
      }

      function animateArrow(sense) {
        //var count = 0;
        //offsetId = window.setInterval(function() {
          if (sense == -1) {
            count = (count - 1) % 200;
          }
          else {
            count = (count + 1) % 200;
          }

          var icons = line.get('icons');
          icons[0].offset = (count / 2) + '%';
          line.set('icons', icons);
        //}, 250);
      }

      function draw_circle_fences() {
        test_fences[0]['shapes'].forEach( function(s) {
          point = new google.maps.LatLng(s['generators'][0][1],s['generators'][0][0]);

          // Draw circles
          var populationOptions = {
            strokeColor: "#0F000F",
            strokeOpacity: 0.15,
            strokeWeight: 1,
            fillColor: "#0F000F",
            fillOpacity: 0.15,
            map: map,
            center: point,
            radius: s['radius']*0.81
          };
          new google.maps.Circle(populationOptions);
        });
      }

      function draw_fences() {
        test_fences[0]['shapes'].forEach( function(s) {
          shapepath = [];
          s['points'].forEach( function(p) {
            if (p) {
              shapepath.push(new google.maps.LatLng(p[1],p[0]));
            }
            else{
              console.log(objJSON['body'])
            }
          });

          // Draw shape
          var shapeOptions = {
            strokeColor: "#0F0F0F",
            strokeOpacity: 0.15,
            strokeWeight: 1,
            fillColor: "#0F0F0F",
            fillOpacity: 0.15,
            map: map,
            path: shapepath
          };
          var shape = new google.maps.Polygon(shapeOptions);

          shape.setMap(map);
        });
      }

      function update_circles() {
        // Bounding check for buttons
        if (step < 0 ) {
          step = 0;
          return;
        }
        if (step >= test_circlesRAW.length ) {
          step = test_circlesRAW.length;
          return;
        }

        // Delete previous circles
        drawn_circles.forEach( function(c) {
          c.setMap(null);
        });

        // Draw each of the new circles
        var test_circles = test_circlesRAW[step];
        //for (var i=0; i<test_circles.length; i++) {
        test_circles['centers'].forEach( function(p) {
          if (p) {
            point = new google.maps.LatLng(p[1],p[0]);

            var col = null;
            if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#FF0000";
            }
            else if (test_circles['type'][test_circles['centers'].indexOf(p)] == 'ARRIVING') {
              col = "#00FF00";
            }
            else {
              col = "#0000FF";
            }

            // Draw circles
            var populationOptions = {
              strokeColor: col,
              strokeOpacity: 0.6,
              strokeWeight: 1,
              fillColor: col,
              fillOpacity: 0.35,
              map: map,
              center: point,
              radius: test_circles['radii'][test_circles['centers'].indexOf(p)]*0.81
            };
            var c = new google.maps.Circle(populationOptions);
            drawn_circles.push(c);

          }
          else{
            console.log(test_circles['centers'])
          }
        //}
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body style="font-family: Arial; border: 0 none;">
    <div id="map-canvas" style="width: 800px; height: 400px"></div>
    <div>
      Position: 
      <button onclick='animateArrow(-1);' type="button">&lt;</button>
      <button onclick='animateArrow(1);' type="button">&gt;</button>
      <br>
      Request:
      <button onclick='if (sim_debug) { step -= 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&lt;</button>
      <button onclick='if (sim_debug) { step += 1; update_circles();} else {console.log("Please enable debug mode")}' type="button">&gt;</button>
      <br>
      Lon: <input class="lon" type="text" name="lon" value="139.698345">
      Lat: <input class="lat" type="text" name="lat" value="35.666641">
      Length: <input class="length" type="text" name="length" value="2000">m
      <br>
      <input type="submit" onclick="getNewPath()" value="Get new route">
    </div>
    <div class="info"></div>
  </body>
</html>
